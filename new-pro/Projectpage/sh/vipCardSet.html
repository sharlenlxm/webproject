<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../public/css/font.css">
		<link rel="stylesheet" href="../../public/fonts/icon/iconfont.css">
		<link rel="stylesheet" href="../../public/css/xadmin.css">
		<link rel="stylesheet" href="../../public/css/card.css">
		<script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="../../public/js/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../public/js/xadmin.js"></script>
		<script type="text/javascript" src="../../public/js/tableSelect.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
		<style type="text/css">
			.layui-input-inline.widthauto,
			.layui-form-mid.widthauto {
				margin: 0;
			}

			.consumeCard {
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.consumeCard::after {
				display: none;
			}

			.layui-form-checkbox span {
				width: 60px;
				text-align: left;
			}

			.cardQrcode img {
				width: 100%;
			}
		</style>
	</head>

	<body id="iosiframe">
		<div class="x-nav">
			<span class="layui-breadcrumb">
				<a>会员卡管理</a>
				<a><cite>会员卡配置</cite></a>
			</span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);"
			 title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
		</div>
		<script type="text/javascript">
			$(function() {
				var navH = $(".cardSetpreview").offset().top;
				$(window).scroll(function() {
					var scroH = $(this).scrollTop();
					if (scroH >= navH) {
						$(".cardSetpreview").css({
							'top': '10px'
						});
					} else if (scroH < navH) {
						$(".cardSetpreview").css({
							'top': '60px'
						});
					}
				})
			})
		</script>
		<div class="x-body">
			<div class="layui-row">
				<div class="layui-col-xs3 layui-col-sm3 layui-col-md3 cardSetpreview">
					<div class="card_boby">
						<div class="card_b card_bc1">
							<img class="card_b_bg" id="cardBimg">
							<div class="card_b_lt card_posi">
								<img src="./images/logo.png" id="ppLogopv">
								<p class="ltNamepv"></p>
							</div>
							<div class="card_b_ld card_posi">
								<!-- <p><i class="icon icon icon-dailiguanli1"></i>黄金会员</p> -->
								<p>NO.8888 8888 8888 8888</p>
							</div>
							<div class="card_b_rt card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div>
							<!-- <div class="card_b_rd card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div> -->
						</div>
						<ul class="card_qList">
							<li class="card_qListli">
								<h3>积分</h3>
								<p>1200</p>
							</li>
							<li class="card_qListli">
								<h3>余额</h3>
								<p>1200<span>(元)</span></p>
							</li>
							<li class="card_qListli">
								<h3>优惠券</h3>
								<p>12<span>(张)</span></p>
							</li>
							<li class="card_qListli">
								<h3>等级</h3>
								<p>Lv.12</p>
							</li>
						</ul>
					</div>
					<div class="space10"></div>
					<ul class="card_fList">
						<li class="card_fListli">
							付费升级
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							积分记录
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							卡券商城
							<i class="iconfont"></i>
						</li>
					</ul>
				</div>
				<div class="layui-col-xs9 layui-col-sm9 layui-col-md9 cardSet">
					<div class="layui-form" lay-filter="basic">
						<div class="layui-form-item consumeCard">
							<div class="layui-input-inline widthauto">
								<label class="layui-form-label widthauto">会员卡ID</label>
								<div class="layui-form-mid">pHucvv9_7VbjAJflf8jy51X_egHE</div>
							</div>
							<div class="layui-input-inline widthauto" style="display: flex;justify-content: space-around;align-items: center;">
								<label class="layui-form-label widthauto">会员卡状态</label>
								<div class="layui-btn layui-btn-normal layui-btn-sm">已同步微信</div>
								<div class="layui-btn layui-btn-normal layui-btn-sm vipCardLink">会员卡领取链接</div>
							</div>
						</div>
						<div class="layui-form-item">
							<fieldset class="layui-elem-field layui-field-title" style="margin-top: 0;">
								<legend style="font-weight: 500;">基本设置</legend>
							</fieldset>
							<div class="layui-form-item max600">
								<label class="layui-form-label">品牌名称</label>
								<div class="layui-input-block">
									<input type="text" name="institutionRoute" class="layui-input" lay-verify="ltName" id="ltName" value="闪盒收银">
								</div>
							</div>
							<div class="layui-form-item" style="display: flex;justify-content: flex-start;align-items: center;">
								<label class="layui-form-label">品牌logo</label>
								<div class="layui-input-inline pinpaiLogo">
									<div class="layui-upload-list">
										<img class="layui-upload-img" id="ppLogo">
									</div>
								</div>
								<div class="layui-form-mid layui-word-aux">尺寸120px*120px，支持JPG、JPEG、PNG图片，文件小于1M</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">会员卡颜色</label>
								<div class="layui-input-block chooseColor">
									<span data-color="colorC1" class="card_bc1 chooseCC layui-icon layui-icon-ok"></span>
									<span data-color="colorC2" class="card_bc2"></span>
									<span data-color="colorC3" class="card_bc3"></span>
									<span data-color="colorC4" class="card_bc4"></span>
									<span data-color="colorC5" class="card_bc5"></span>
									<span data-color="colorC6" class="card_bc6"></span>
									<span data-color="colorC7" class="card_bc7"></span>
									<span data-color="colorC8" class="card_bc8"></span>
									<span data-color="colorC9" class="card_bc9"></span>
									<span data-color="colorC10" class="card_bc10"></span>
									<span data-color="colorC11" class="card_bc11"></span>
								</div>
							</div>
							<div class="layui-form-item" style="display: flex;justify-content: flex-start;align-items: center;">
								<label class="layui-form-label">会员卡背景</label>
								<div class="layui-input-inline cardBgimg">
									<div class="layui-upload-list">
										<img class="layui-upload-img" id="cardBgimg">
									</div>
								</div>
								<div class="layui-form-mid layui-word-aux">尺寸120px*120px，支持JPG、JPEG、PNG图片，文件小于1M</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">开卡设置</label>
								<div class="layui-input-block">
									<input type="checkbox" class="set" lay-skin="primary" name="name" title="会员名称">
									<input type="checkbox" class="set" lay-skin="primary" name="tel" title="手机号">
									<input type="checkbox" class="set" lay-skin="primary" name="shengri" title="生日">
									<input type="checkbox" class="set" lay-skin="primary" name="mail" title="邮箱">
									<input type="checkbox" class="set" lay-skin="primary" name="address" title="地址">
								</div>
								<div class="layui-input-block">
									<input type="checkbox" class="set" lay-skin="primary" name="chengwei" title="称谓">
									<input type="checkbox" class="set" lay-skin="primary" name="team" title="分组">
									<input type="checkbox" class="set" lay-skin="primary" name="tap" title="标签">
									<input type="checkbox" class="set" lay-skin="primary" name="header" title="头像">
									<input type="checkbox" class="set" lay-skin="primary" name="mark" title="备注信息">
								</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">开卡限制</label>
								<div class="layui-input-block">
									<input type="radio" name="xianzhi" value="0" title="全部可领" checked="">
									<input type="radio" name="xianzhi" value="1" title="微信领取">
									<input type="radio" name="xianzhi" value="1" title="支付宝领取">
								</div>
							</div>
							<div class="layui-form-item max600">
								<label class="layui-form-label">适用门店</label>
								<div class="layui-input-block">
									<input type="text" name="institutionRoute" class="layui-input" lay-verify="" id="symd" placeholder="请选择适用门店">
								</div>
								<label class="layui-form-label"></label>
								<div class="layui-form-mid layui-word-aux">可不限制，门店核销或会员到店消费前，需要效验此项</div>
							</div>
							<div class="layui-form-item max600">
								<label class="layui-form-label">操作提示</label>
								<div class="layui-input-block">
									<input type="text" name="institutionRoute" class="layui-input" lay-verify="zonghoutai" id="zonghoutai"
									 placeholder="请输入操作提示">
								</div>
							</div>
							<div class="layui-form-item max600">
								<label class="layui-form-label">特权说明</label>
								<div class="layui-input-block">
									<textarea class="layui-textarea" name="alipayPaymentGateway" autocomplete="off" placeholder="请输入特权说明" rows="3"
									 lay-verify=""></textarea>
								</div>
							</div>
							<div class="layui-form-item max600">
								<label class="layui-form-label">使用须知</label>
								<div class="layui-input-block">
									<textarea class="layui-textarea" name="alipayPaymentGateway" autocomplete="off" placeholder="请输入使用须知" rows="3"
									 lay-verify=""></textarea>
								</div>
							</div>
							<div class="layui-form-item max600">
								<label class="layui-form-label">联系电话</label>
								<div class="layui-input-block">
									<input type="text" name="institutionRoute" class="layui-input" lay-verify="zonghoutai" id="zonghoutai"
									 placeholder="请输入联系电话">
								</div>
							</div>
						</div>
						<!-- <blockquote class="layui-elem-quote">消费积分规则</blockquote> -->
						<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							<legend style="font-weight: 500;">分享设置</legend>
						</fieldset>

						<div class="layui-form-item max600">
							<label class="layui-form-label">分享标题</label>
							<div class="layui-input-block">
								<input type="text" name="institutionRoute" class="layui-input" lay-verify="zonghoutai" id="zonghoutai"
								 placeholder="请输入操作提示">
							</div>
						</div>
						<div class="layui-form-item max600">
							<label class="layui-form-label">分享描述</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" name="alipayPaymentGateway" autocomplete="off" placeholder="请输入特权说明" rows="3"
								 lay-verify=""></textarea>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-form-item layui-layout-admin">
								<div class="layui-input-block">
									<div class="layui-footer" style="left: 0;text-align: center;">
										<button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
										<button type="reset" class="layui-btn layui-btn-primary">取消</button>
									</div>
								</div>
							</div>
						</div>
						<div class="cardQrcode" style="display: none;">
							<img src="./images/erweima.jpg">
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="../../common/config-sh.js"></script>
		<script src="../../common/utility.js"></script>
		<script>
			var serverUrl = 'http://192.168.1.190:5002/'
			// var userNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;

			var code1;
			var jgData;
			var merchantca = false;
			var type;
			var logoUrl = '';
			var chooseCnum

			layui.use(['laydate', 'table', 'form', 'laytpl', 'upload'], function() {
				layui.$.support.cors = true; //允许ajax跨域
				var $ = layui.jquery,
					upload = layui.upload,
					laydate = layui.laydate,
					table = layui.table,
					form = layui.form,
					laytpl = layui.laytpl;
				var tableSelect = layui.tableSelect;

				tableSelect.render({
					elem: '#symd',
					searchKey: 'my',
					checkedKey: 'id',
					searchPlaceholder: '门店名称',
					table: {
						url: 'table.json',
						cols: [
							[{
								type: 'checkbox'
							}, {
								field: 'username',
								title: '门店名称',
							}]
						]
					},
					done: function(elem, data) {
						var NEWJSON = []
						layui.each(data.data, function(index, item) {
							NEWJSON.push(item.username)
						})
						elem.val(NEWJSON.join(","))
					}
				})


				var $b1 = $('#newfenzu'),
					$i1 = $('#newfenzuVal'),
					$b2 = $('#newchengwei'),
					$i2 = $('#newchengweiVal'),
					$b3 = $('#newtag'),
					$i3 = $('#newtagVal');
				$i1.keyup(function(e) {
					if (e.keyCode == 13) {
						$b1.click();
					}
				});
				$i2.keyup(function(e) {
					if (e.keyCode == 13) {
						$b2.click();
					}
				});
				$i3.keyup(function(e) {
					if (e.keyCode == 13) {
						$b3.click();
					}
				});
				//会员分组设置
				var teamList = ['分组一', '分组二', '分组三']

				function getTeam() {
					var strT = ''
					for (let i = 0; i < teamList.length; i++) {
						strT += '<input type="checkbox" class="set" name="name" title="' + teamList[i] +
							'" checked=""><span class="del fenzu" data-id="' + i + '" onclick="delfenzu(' + i +
							')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
					}
					$('#teamList').html(strT)
					form.render()
				}
				getTeam()
				$('#newfenzu').click(function() {
					var newfenzuVal = $i1.val()
					if (teamList.indexOf(newfenzuVal) >= 0) {
						layer.msg('分组名重复，请重新输入')
						return
					}
					$i1.val("")
					teamList.push(newfenzuVal)
					console.log(teamList)
					getTeam()
				})
				//会员称谓设置
				var chengweiList = ['称谓一', '称谓二', '称谓三']

				function getChengwei() {
					var strT = ''
					for (let ii = 0; ii < chengweiList.length; ii++) {
						strT += '<input type="checkbox" class="set" name="name" title="' + chengweiList[ii] +
							'" checked=""><span class="del chengwei" data-id="' + ii + '" onclick="delchengwei(' + ii +
							')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
					}
					$('#chengweiList').html(strT)
					form.render()
				}
				getChengwei()
				$('#newchengwei').click(function() {
					var newchengweiVal = $i2.val()
					if (teamList.indexOf(newchengweiVal) >= 0) {
						layer.msg('分组名重复，请重新输入')
						return
					}
					$i2.val("")
					chengweiList.push(newchengweiVal)
					console.log(teamList)
					getChengwei()
				})
				//会员标签设置
				var tagList1 = ['标签一', '标签二', '标签三']

				function tagList() {
					var strT = ''
					for (let iii = 0; iii < tagList1.length; iii++) {
						strT += '<input type="checkbox" class="set" name="name" title="' + tagList1[iii] +
							'" checked=""><span class="del tag" data-id="' + iii + '" onclick="deltag(' + iii +
							')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
					}
					$('#tagList').html(strT)
					form.render()
				}
				tagList()
				$('#newtag').click(function() {
					var newtagVal = $i3.val()
					if (teamList.indexOf(newtagVal) >= 0) {
						layer.msg('分组名重复，请重新输入')
						return
					}
					$i3.val("")
					tagList1.push(newtagVal)
					console.log(teamList)
					tagList()
				})
				window.delfenzu = function(num) {
					teamList.splice(num, 1)
					getTeam()
				}
				window.delchengwei = function(num) {
					chengweiList.splice(num, 1)
					getChengwei()
				}
				window.deltag = function(num) {
					tagList1.splice(num, 1)
					tagList()
				}

				/*---------- Input监听 ----------*/
				ltname()
				/*---------- 品牌logo ----------*/
				var uploadInst = upload.render({
					elem: '#ppLogo',
					url: '/upload/',
					size: 1024,
					accept: 'file',
					exts: 'jpg|jpeg|png',
					before: function(obj) {
						//预读本地文件示例，不支持ie8
						obj.preview(function(index, file, result) {
							$('#ppLogo').attr('src', result); //图片链接（base64）
							$('#ppLogopv').attr('src', result); //图片链接（base64）
						});
					},
					done: function(res) {
						//如果上传失败
						if (res.code > 0) {
							return layer.msg('上传失败');
						}
						//上传成功
					},
					error: function() {
						//演示失败状态，并实现重传
						// var demoText = $('#demoText');
						// demoText.html(
						// 	'<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
						// demoText.find('.demo-reload').on('click', function() {
						// 	uploadInst.upload();
						// });
					},
				});

				/*---------- 会员卡背景 ----------*/
				var uploadInst = upload.render({
					elem: '#cardBgimg',
					url: '/upload/',
					before: function(obj) {
						//预读本地文件示例，不支持ie8
						obj.preview(function(index, file, result) {
							$('#cardBgimg').attr('src', result); //图片链接（base64）
							$('#cardBimg').attr('src', result); //图片链接（base64）
						});
					},
					done: function(res) {
						//如果上传失败
						if (res.code > 0) {
							return layer.msg('上传失败');
						}
						//上传成功
					},
					error: function() {
						//演示失败状态，并实现重传
						var demoText = $('#demoText');
						demoText.html(
							'<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
						demoText.find('.demo-reload').on('click', function() {
							uploadInst.upload();
						});
					}
				});

				$('.vipCardLink').click(function() {
					layer.open({
						type: 1,
						shadeClose: true,
						shade: 0.5,
						title: false,
						content: $('.cardQrcode'),
					});
				})

				/*---------- 监听开关 ----------*/
				form.on('switch(timePreferences)', function(data) { //计时开关
					if (data.elem.checked == true) {
						$('#timing').show()
						data.elem.value = "0"
						console.log(data.elem.value)
					} else if (data.elem.checked == false) {
						data.elem.value = "1"
						console.log(data.elem.value)
						$('#timing').hide()
					}
				});
				//表单初始赋值
				form.val('basic', {
					"timePreferences": true
				})
				//监听提交
				form.on('submit(add)', function(data) {
					if (!chooseCnum) {
						data.chooseCnum = 1
					} else {
						data.chooseCnum = chooseCnum
					}
					console.log(data.chooseCnum)
					if (logoUrl == '') {
						layer.msg('请上传logo图片')
						return false
					}
					data.institutionLogo = logoUrl
					data.institutionNumber = userNumber
					// layer.alert(JSON.stringify(data.field), {
					//  title: '最终的提交信息'
					// })
					return false;
				});
			});

			$('.chooseColor span').click(function(e) {
				chooseCnum = $('.chooseColor span').index(this) + 1
				$(this).siblings('span').removeClass('chooseCC layui-icon layui-icon-ok')
				$(this).addClass('chooseCC layui-icon layui-icon-ok')
				$('.card_b').attr("class", 'card_b card_bc' + chooseCnum)
			})

			function ltname() {
				$('.ltNamepv').text($("#ltName").val())
				$("#ltName").on("input", function(e) {
					//获取input输入的值
					console.log(e.delegateTarget.value);
					$('.ltNamepv').text(e.delegateTarget.value)
				});
			}
		</script>
	</body>

</html>
