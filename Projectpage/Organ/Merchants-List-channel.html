<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    .layui-table-box,.layui-table-body{
        overflow: inherit;
    }{
        overflow: inherit;
    }
    .layui-btn+.layui-btn {
        margin-left: -2px;
    }

    .layui-table-cell {
        height: auto;
        overflow: inherit;
    }

    .layui-form-select dl {
        text-align: left;
    }

    .operationList th:nth-child(1) {
        width: 50px;
    }

    .operationList td:nth-child(1) {
        text-align: center;
    }

    .operation_select .layui-form-select {
        width: 90%;
    }

    .operation_table .layui-table {
        width: 90%;
        border: 1px solid #e6e6e6;
        border-width: 1px !important;
    }

    .operation_table .layui-table tr th:last-child {
        text-align: center;
    }

    .operation_table .layui-table tr td:nth-child(1) {
        text-align: center;
    }

    .operation_table .layui-table tr td:nth-child(4) {
        text-align: center;
        padding-left: 10px;
        padding-right: 10px;
        box-sizing: border-box;
    }
    </style>
</head>

<body id="iosiframe">
    <div class="x-body">
        <div class="layui-form">
            <table class="layui-hide" id="members" lay-filter="members"></table>
            <div class="layui-form-item layui-layout-admin">
                <div class="layui-input-block">
                    <div class="layui-footer" style="left: 0;text-align: center;">
                       <!--  <button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button> -->
                        <button class="layui-btn layui-btn-primary" id="quxiao">关闭</button>
                    </div>
                    <!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
                </div>
            </div>
        </div>
    </div>
    <script type="text/html" id="switchBar">
        <input type="checkbox" name="consumptionPreferences" lay-skin="switch" lay-filter="consumptionPreferences" lay-text="开|关" {{d.Interface_Switch==0 ? 'checked' : ''}} value="{{d.Payment_Type_ID}}">
		</script>
    <script type="text/html" id="toolbar">
        <div class="layui-input-inline" style="width: 100px;margin-bottom: 10px;">
				<input type="radio" name="operation{{d.Payment_Type_ID}}" data_pid="{{d.Payment_Type_ID}}"  {{d.Wheel_Search==0 ? 'checked' : ''}}  value="0" title="单独" lay-filter="operation" checked="">
			</div>
			<div class="layui-input-inline" style="width: 100px;margin-bottom: 10px;">
				<input type="radio" name="operation{{d.Payment_Type_ID}}" data_pid="{{d.Payment_Type_ID}}"   {{d.Wheel_Search==1 ? 'checked' : ''}}  value="1" title="轮询" lay-filter="operation">
			</div>
			<div class="layui-input-block operation_select" id="operation_select{{d.Payment_Type_ID}}" style="margin-left: 0;">
				<select name="quiz{{d.Payment_Type_ID}}">
					
                     {{#  layui.each(d.channel, function(index, item){ }}
                 
                       <option value={{item.sCode}}>{{item.sName}}</option>
                
                    {{#  }); }}
				</select>
                
			</div>
			<div class="layui-input-block operation_table" id="operation_table{{d.Payment_Type_ID}}" style="margin-left: 0;display: none;">
				<table class="layui-table" lay-skin="line" id="" style="">
					<thead>
						<tr>
                            <th></th>
							<th >通道代码</th>
							<th >通道名称</th>
							<th>权重(1-9)</th>
						</tr>
					</thead>
					<tbody>
                        {{#  layui.each(d.channel, function(index, item){ }}
                          <tr>
                            <td>
                                <input type="checkbox" name="" lay-skin="primary" {{item.sType==0 ? 'checked' : ''}}>
                            </td>
                            <td>{{ item.sCode }}</td>
                            <td>{{ item.sName }}：</td>
                            <td><input type="number" min="0" max="9" name="" class="layui-input" value="{{ item.sWeight  }}"></td>
                          </tr>
                        {{#  }); }}
						
						
					</tbody>
				</table>
			</div>
		</script>
        <script src="../../common/config.js"></script>
        <script src="../../common/utility.js"></script>
    <script>

    var index = parent.layer.getFrameIndex(window.name);
            $('#quxiao').click(function(){
                
                setTimeout(function(){parent.layer.close(index)},16); 
            })
            function changeRes(data){
                console.log(data)
                if(data == null){
                    return
                }
                for(var i = 0 ; i < data.length;i++){
                    var arrr = new Array()
                    if(data[i].Payment_Channel == ''){

                    }else if(data[i].Payment_Channel.indexOf('|') >= 0){
                        var channel = data[i].Payment_Channel.split('|')
                        for(var j = 0 ; j < channel.length;j++){
                            var aobj = new Object()
                            aobj.sCode = channel[j].split(':')[0]
                            aobj.sName = channel[j].split(':')[1]
                            aobj.sWeight = channel[j].split(':')[2]
                            aobj.sType = channel[j].split(':')[2] == 0?1:0 
                            arrr.push(aobj)
                        }
                    }else if(data[i].Payment_Channel.indexOf('|') < 0){
                        var aobj = new Object()
                        aobj.sCode = data[i].Payment_Channel.split(':')[0]
                        aobj.sName = data[i].Payment_Channel.split(':')[1]
                        aobj.sWeight = data[i].Payment_Channel.split(':')[2]
                        aobj.sType = data[i].Payment_Channel.split(':')[2] == 0?1:0 
                        arrr.push(aobj)
                    }
                   data[i].channel = arrr
                }
                console.log(data)
                return data
            }
        function  subPage(data, data1){
            var serverUrl = window.parent.serverUrl
            var userNumber = JSON.parse(sessionStorage.getItem('organUser')).Number;
            var jgData = data
            console.log(jgData)
            layui.use(['laytpl', 'laydate', 'table', 'form'], function() {
                var laytpl = layui.laytpl,
                    laydate = layui.laydate,
                    table = layui.table,
                    form = layui.form;

                //方法级渲染  
                table.render({
                    //url: serverUrl + 'memberCard/getAssociatorCards?userNumber=' + userNumber,
                    url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getMerchantTD + '?merchantNumber=' + jgData.merchantNumber ,
                    elem: '#members',
                    id: 'vip_cardList',
                    response: { 
                    //res 即为原始返回的数据
                            "statusCode":"1000", //解析接口状态
                            
                    },
                    parseData: function(res) { //res 即为原始返回的数据
                     return {
                         "code": res.code, //解析接口状态
                         "msg": res.msg, //解析提示文本
                         //"count": res.count, //解析数据长度
                         "data": changeRes(res.data), //解析数据列表
                     };
                    },
                    cols: [
                        [{
                            align: 'center',
                            field: 'Payment_Type_Name',
                            title: '支付产品',
                            sort: true,
                            width: 200
                        }, {
                            align: 'center',
                            toolbar: '#switchBar',
                            title: '接口状态',
                            width: 200
                        }, {
                            align: 'center',
                            title: '支付通道',
                            toolbar: '#toolbar',
                            event: 'setToolbar',
                            minWidth: 550
                        }]
                    ],
                    page: false,
                    done: function(res, curr, count) {
                    }
                });

                /*---------- 监听开关 ----------*/
                form.on('radio(operation)', function(obj) { //
                    var did = this.name.split("operation")[1]
                    console.log(did)
                    var opersel = document.getElementById('operation_select'+did)
                    var opertable = document.getElementById('operation_table'+did)
                  
                    if (this.value == 0) {
                         opersel.style.display = 'block'
                         opertable.style.display = 'none'
                        table.render();
                    } else if (this.value == 1) {
                        opersel.style.display = 'none'
                        opertable.style.display = 'block'
                        form.render();
                    }
                });

                //监听工具条
                
            });
        }
  
    </script>
</body>

</html>