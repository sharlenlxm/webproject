<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../public/css/font.css">
		<link rel="stylesheet" href="../../public/fonts/icon/iconfont.css">
		<link rel="stylesheet" href="../../public/css/xadmin.css">
		<link rel="stylesheet" href="../../public/css/card.css">
		<link rel="stylesheet" href="../../public/css/vipS.css">
		<script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="../../public/js/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../public/js/xadmin.js"></script>
		<script type="text/javascript" src="../../public/js/tableSelect.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
		<style type="text/css">
			.show {
				display: block;
			}

			.hide {
				display: none;
			}

			.layui-form-label {
				width: 200px;
			}

			.cardSet {
				padding: 0;
			}

			.cardSet .layui-upload-list {
				border-bottom-left-radius: 0;
				border-bottom-right-radius: 0;
			}

			.cardSet .upTips {
				/* display: block; */
				position: initial;
				line-height: 40px;
				background: #1E9FFF;
				color: #fff;
				border: none;
				border-radius: 0;
			}

			.cardSet .layui-textarea {
				border-radius: 0;
				border-bottom-left-radius: 6px;
				border-bottom-right-radius: 6px;
			}

			.iwList li {
				margin-bottom: 20px;
				position: relative;
			}

			.iwList img {
				height: 222px;
			}

			.iwList .layui-input-inline {
				width: auto !important;
				margin: 0;
			}

			.iwList .imgDel {
				line-height: 222px;
			}

			.iwList .delBtn {
				position: absolute;
				right: -20px;
				top: -20px;
			}

			.iwList .layui-upload-list {
				border: 1px solid #e6e6e6;
				border-bottom: none;
			}

			.layui-elem-quote .layui-form-switch {
				width: 50px;
			}

			.layui-form-switch em {
				top: -1px;
			}

			.layui-form-switch i {
				top: 2px;
			}

			.tmTab .layui-tab-title {
				height: 55px;
				line-height: 55px;
				border-bottom: 2px solid #e0e0e0;
			}

			.tmTab .layui-tab-title li {
				width: auto;
				height: 55px;
				line-height: 55px;
				font-size: 16px;
				padding: 0 20px;
			}

			.tmTab .layui-tab-title li.layui-this {
				border-bottom: 2px solid #63b359;
			}

			.tmTab .layui-tab-title .layui-this:after {
				border: none;
			}

			.tmTab .layui-tab-item {
				padding: 10px;
			}
		</style>
	</head>

	<body id="iosiframe" class="iframe_index_1 autoHeight">
		<script type="text/javascript">
			$(function() {
				var navH = $(".cardSetpreview").offset().top;
				$(window).scroll(function() {
					var scroH = $(this).scrollTop();
					if (scroH >= navH) {
						$(".cardSetpreview").css({
							'top': '10px'
						});
					} else if (scroH < navH) {
						$(".cardSetpreview").css({
							'top': '40px'
						});
					}
				})
			})
		</script>
		<div class="x-body iframe_index_1_con">
			<div class="layui-row">
				<div class="layui-col-xs3 layui-col-sm3 layui-col-md3 cardSetpreview" style="top: 40px;">
					<img src="./images/topbar.png" class="topbar">
					<div class="card_boby">
						<div class="card_b card_bc1">
							<img class="card_b_bg" src="./images/cardBg_default.png" id="cardBimg">
							<div class="card_b_lt card_posi">
								<img src="./images/card_logo.png" id="ppLogopv">
								<div class="">
									<p class="ltN"></p>
									<p class="ltNamepv"></p>
								</div>
							</div>
							<div class="card_b_ld card_posi">
								<!-- <p><i class="icon icon icon-dailiguanli1"></i>黄金会员</p> -->
								<p>NO.8888 8888 8888 8888</p>
							</div>
							<!-- <div class="card_b_rt card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div>
							<div class="card_b_rd card_posi">
								<span><i class="icon icon icon-dailiguanli1"></i></span>
								<p>黄金会员</p>
							</div> -->
						</div>
						<ul class="card_qList">
							<li class="card_qListli ">
								<h3>剩余次数：<span>0</span></h3>
							</li>
							<li class="card_qListli lishow">
								<h3>使用时间：2019-10-10 - 2019-20-20</h3>
							</li>
						</ul>
					</div>
					<ul class="card_fList" style="border-top: 1px solid #e6e6e6;">
						<li class="card_fListli">
							<div class="card_fListliDiv">
								<p>推荐给朋友</p>
								<span></span>
							</div>
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							<div class="card_fListliDiv">
								<p>会员卡详情</p>
								<span></span>
							</div>
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							<div class="card_fListliDiv">
								<p>适用门店</p>
								<span></span>
							</div>
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							<p>会员卡详情</p>
							<i class="iconfont"></i>
						</li>
						<li class="card_fListli">
							<p>公众号</p>
							<i class="iconfont"></i>
						</li>
					</ul>
				</div>
				<div class="layui-col-xs9 layui-col-sm9 layui-col-md9 cardSet" style="margin-bottom: 44px;">
					<div class="layui-form" lay-filter="basic">

						<div class="layui-tab tmTab">
							<ul class="layui-tab-title">
								<li class="layui-this">基本设置</li>
								<li>中心按钮</li>
								<li>自定义/营销入口</li>
								<li>次/月卡详情</li>
							</ul>
							<div class="layui-tab-content">
								<!-- tab1 -->
								<div class="layui-tab-item layui-show">
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>品牌名称 :</label>
										<div class="layui-input-inline max360">
											<input type="text" name="subtitle1" value="品牌名称" class="layui-input" autocomplete="off" lay-verify="ltName"
											 id="ltName">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>次/月卡标题 :</label>
										<div class="layui-input-inline max360">
											<input type="text" name="subtitle1" value="次/月卡标题" class="layui-input" autocomplete="off" lay-verify="ltNamefu"
											 id="ltNamefu">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>品牌logo :</label>
										<div class="layui-input-inline max360 pinpaiLogo">
											<div class="layui-upload-list">
												<div class="layui-upload-img" id="cardLo">
													<img src="./images/card_logo.png" id="cardLoImg">
													<div class="upTips">
														+<br />上传logo
													</div>
												</div>
												<div class="imgDel" data-id="cardLo" style="display: none;">
													<i class="layui-icon layui-unselect layui-tab-close">ဆ</i>
												</div>
											</div>
										</div>
										<div class="layui-input-inline max360 layui-word-aux">尺寸120px*120px，支持JPG、JPEG、PNG图片，文件小于1M</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>次/月卡单位 :</label>
										<div class="layui-input-inline max360">
											<input type="text" name="subtitle" class="layui-input" autocomplete="off" lay-verify="ltName">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>库存 :</label>
										<div class="layui-input-inline max360">
											<input type="number" name="subtitle" class="layui-input" autocomplete="off" max="10000000" lay-verify="ltName">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>code展示类型 :</label>
										<div class="layui-input-inline max360">
											<select name="interest" lay-filter="aihao">
												<option value="1" selected="">二维码</option>
											</select>
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>卡券类型 :</label>
										<div class="layui-input-inline max360 tmType">
											<input type="radio" name="codeType" lay-filter="tmType" value="0" title="次卡" checked="">
											<input type="radio" name="codeType" lay-filter="tmType" value="1" title="月卡">
										</div>
									</div>
									<div class="tmType0 show">
										<!-- 次卡 -->
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>次卡规格 :</label>
											<div class="layui-input-inline widthauto">
												<input type="text" name="entryForce" autocomplete="off" lay-verify="entryForce" placeholder="领取后多少天后开始生效"
												 class="layui-input">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>限制使用时间 :</label>
											<div class="layui-input-inline max360 barcodeshow">
												<input type="radio" name="codeType1" lay-filter="barcodeshow" value="0" title="是" checked="">
												<input type="radio" name="codeType1" lay-filter="barcodeshow" value="0" title="否">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>领取后多少天后开始生效 :</label>
											<div class="layui-input-inline widthauto">
												<input type="text" name="entryForce" id="entryForce" autocomplete="off" lay-verify="entryForce" placeholder="领取后多少天后开始生效"
												 class="layui-input">
											</div>
											<div class="layui-form-mid layui-word-aux">0代表当天生效</div>
										</div>
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>生效后多少天内有效 :</label>
											<div class="layui-input-inline widthauto">
												<input type="text" name="effectiveDay" id="effectiveDay" autocomplete="off" lay-verify="effectiveDay"
												 placeholder="生效后多少天内有效" class="layui-input">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>指定具体使用时间 :</label>
											<div class="layui-input-inline widthauto">
												<input type="text" id="limitUseTimeTyperange" autocomplete="off" readonly="readonly" placeholder="请指定具体使用时间"
												 class="layui-input">
											</div>
										</div>
									</div>
									<div class="tmType1 hide">
										<!-- 月卡 -->
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>卡券不限次数 :</label>
											<div class="layui-input-inline max360 barcodeshow">
												<input type="radio" name="codeType2" lay-filter="barcodeshow" value="0" title="是" checked="">
												<input type="radio" name="codeType2" lay-filter="barcodeshow" value="0" title="否">
											</div>
										</div>
										<div class="layui-form-item">
											<label class="layui-form-label"><span class="redC">* </span>指定具体使用时间 :</label>
											<div class="layui-input-inline widthauto">
												<input type="text" id="limitUseTimeTyperange" autocomplete="off" readonly="readonly" placeholder="请指定具体使用时间"
												 class="layui-input">
											</div>
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>是否允许续费 :</label>
										<div class="layui-input-inline max360 barcodeshow">
											<input type="radio" name="codeType3" lay-filter="barcodeshow" value="0" title="是" checked="">
											<input type="radio" name="codeType3" lay-filter="barcodeshow" value="0" title="否">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>是否显示出售 :</label>
										<div class="layui-input-inline max360 barcodeshow">
											<input type="radio" name="codeType4" lay-filter="barcodeshow" value="0" title="是" checked="">
											<input type="radio" name="codeType4" lay-filter="barcodeshow" value="0" title="否">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>每人可购买数量 :</label>
										<div class="layui-input-inline max360">
											<input type="text" name="subtitle" class="layui-input" lay-verify="ltName">
										</div>
									</div>
									<div class="layui-form-item">
										<label class="layui-form-label"><span class="redC">* </span>使用限制 :</label>
										<div class="layui-input-inline max360">
											<input type="text" name="subtitle" class="layui-input" lay-verify="ltName">
										</div>
									</div>
								</div>
								<!-- tab2 -->
								<div class="layui-tab-item">内容2</div>
								<!-- tab3 -->
								<div class="layui-tab-item">
									<!-- 自定义入口一 -->
									<blockquote class="layui-elem-quote consumeTit">
										<i class="leftline"></i>
										自定义入口一
									</blockquote>
									<div class="layui-form-item custom1Body">
										<div class="layui-form-item">
											<div class="layui-input-inline max360 ">
												<input type="radio" name="custom1" lay-filter="custom1" value="0" title="不设置">
												<input type="radio" name="custom1" lay-filter="custom1" value="1" title="自定义链接" checked="">
												<input type="radio" name="custom1" lay-filter="custom1" value="2" title="自定义小程序">
											</div>
										</div>
										<div class="custom1B max600">
											<div class="layui-form-item">
												<label class="layui-form-label"><span class="redC">* </span>入口名称 :</label>
												<div class="layui-input-inline max360">
													<input type="text" name="custom1lNInput" class="layui-input customNameInput" id="custom1lNInput" value="推荐给朋友"
													 placeholder="入口名称">
												</div>
											</div>
											<div class="custom1-link">
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>自定义链接 :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom1lLInput" class="layui-input" lay-verify="customlLInput" id="custom1lLInput"
														 placeholder="自定义链接地址">
													</div>
												</div>
											</div>
											<div class="custom1-miniapp" style="display: none;">
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>小程序ID :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom1mIInput" class="layui-input" id="custom1mIInput" placeholder="小程序ID">
													</div>
												</div>
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>小程序页面 :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom1mPInput" class="layui-input" id="custom1mPInput" placeholder="小程序页面路径path">
													</div>
												</div>
											</div>
											<div class="layui-form-item">
												<label class="layui-form-label">引导语 :</label>
												<div class="layui-input-inline max360">
													<input type="text" name="custom1mYInput" class="layui-input" id="custom1mYInput" placeholder="引导语">
												</div>
											</div>
										</div>
									</div>
									<!-- 自定义入口二 -->
									<blockquote class="layui-elem-quote consumeTit">
										<i class="leftline"></i>
										自定义入口二
									</blockquote>
									<div class="layui-form-item custom2Body">
										<div class="layui-form-item">
											<div class="layui-input-inline max360 ">
												<input type="radio" name="custom2" lay-filter="custom2" value="0" title="不设置">
												<input type="radio" name="custom2" lay-filter="custom2" value="1" title="自定义链接" checked="">
												<input type="radio" name="custom2" lay-filter="custom2" value="2" title="自定义小程序">
											</div>
										</div>
										<div class="custom2B max600">
											<div class="layui-form-item">
												<label class="layui-form-label"><span class="redC">* </span>入口名称 :</label>
												<div class="layui-input-inline max360">
													<input type="text" name="custom2lNInput" class="layui-input customNameInput" id="custom2lNInput" value="会员卡详情"
													 placeholder="入口名称">
												</div>
											</div>
											<div class="custom2-link">
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>自定义链接 :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom2lLInput" class="layui-input" lay-verify="customlLInput" id="custom2lLInput"
														 placeholder="自定义链接地址">
													</div>
												</div>
											</div>
											<div class="custom2-miniapp" style="display: none;">
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>小程序ID :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom2mIInput" class="layui-input" id="custom2mIInput" placeholder="小程序ID">
													</div>
												</div>
												<div class="layui-form-item">
													<label class="layui-form-label"><span class="redC">* </span>小程序页面 :</label>
													<div class="layui-input-inline max360">
														<input type="text" name="custom2mPInput" class="layui-input" id="custom2mPInput" placeholder="小程序页面路径path">
													</div>
												</div>
											</div>
											<div class="layui-form-item">
												<label class="layui-form-label">引导语 :</label>
												<div class="layui-input-inline max360">
													<input type="text" name="custom2mYInput" class="layui-input" id="custom2mYInput" placeholder="引导语">
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- tab4 -->
								<div class="layui-tab-item">
									<div class="layui-form-item">
										<label class="layui-form-label">图文介绍 :</label>
										<div class="layui-input-inline max360">
											<div class="layui-form-mid layui-word-aux">图片建议尺寸：900像素 * 500像素，大小不超过2M。至少上传1组图文，最多输入170字</div>
											<ul class="layui-form-item max400 iwList" id="iwList"></ul>
										</div>
										<div class="layui-input-inline max360" style="display: flex;justify-content: flex-start;align-items: center;margin-bottom: 15px;">
											<button type="button" class="layui-btn" id="addSale" style="margin-right: 15px;">增加图文</button>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="cardQrcode" style="display: none;">
							<img src="./images/erweima.jpg">
						</div>
						<!-- <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
							<div class="layui-block">
								<div class="layui-footer" style="left: 0;text-align: center;">
									<button type="reset" class="layui-btn layui-btn-primary" id="quxiao">取消</button>
									<button class="layui-btn" lay-submit="" lay-filter="nextstep" id="nextstep">下一步</button>
									<button class="layui-btn hide" lay-submit="" lay-filter="laststep" id="laststep">上一步</button>
									<button class="layui-btn hide" lay-submit="" lay-filter="add" id="add">提交</button>
								</div>
							</div>
						</div> -->
					</div>
				</div>
				<div class="layui-form-item layui-layout-admin">
					<div class="layui-input-block">
						<div class="layui-footer" style="left: 0;text-align: center;">
							<button type="reset" class="layui-btn layui-btn-primary" id="quxiao">取消</button>
							<button class="layui-btn" lay-submit="" lay-filter="nextstep" id="nextstep">下一步</button>
							<button class="layui-btn hide" lay-submit="" lay-filter="laststep" id="laststep">上一步</button>
							<button class="layui-btn hide" lay-submit="" lay-filter="add" id="add">提交</button>
						</div>
						<!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
					</div>
				</div>
			</div>
		</div>
		<script src="../../common/config-meb.js"></script>
		<script src="../../common/utility.js"></script>
		<script src="../../common/utility.js"></script>
		<script>
			var insNumber = JSON.parse(sessionStorage.getItem('userSh')).institutionNumber;
			var merNumber = JSON.parse(sessionStorage.getItem('userSh')).Number;

			var cardCon;
			var chooseCnum
			var wxCardNo
			var shopNumbers = []
			var columnDVal = ["积分", "余额", "优惠券", "等级"]
			var merchantSL = ["免费WIFI", "可带宠物", "免费停车", "可外卖"]
			var imageTexts = []
			var imgNum = 0
			var customs = new Array()

			layui.use(['laydate', 'table', 'form', 'laytpl', 'upload'], function() {
				layui.$.support.cors = true; //允许ajax跨域
				var $ = layui.jquery,
					upload = layui.upload,
					laydate = layui.laydate,
					table = layui.table,
					form = layui.form,
					laytpl = layui.laytpl;
				var tableSelect = layui.tableSelect;


				tableSelect.render({
					elem: '#symd',
					searchKey: 'shopName',
					checkedKey: 'shopNumber',
					searchPlaceholder: '门店名称',
					table: {
						url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Merchant.getShops + '?merchantNumber=' +
							merNumber,
						response: {
							"statusCode": "1000", //解析接口状态
						},
						parseData: function(res) {
							if (res.data == null) {
								return
							}
							return {
								"code": res.code,
								"count": res.data.count,
								"data": res.data.result,
							}
						},
						cols: [
							[{
								type: 'checkbox'
							}, {
								field: 'shopName',
								title: '门店名称',
								align: 'center',
							}]
						]
					},
					done: function(elem, data) {
						shopNumbers.splice(0)
						var shopname = []
						layui.each(data.data, function(index, item) {
							shopNumbers.push(item.shopNumber)
							shopname.push(item.shopName)
						})
						elem.val('已选 ' + shopNumbers.length + ' 个门店')
					}
				})


				/*---------- 图文添加 ----------*/
				function saleListFor() {
					var str = ''
					for (let i = 0; i < imageTexts.length; i++) {
						str += '<li><input type="file" class="input_img layui-input" style="display: none;" id="upLogo' + i + '" />' +
							'<div class="layui-input-inline max360 pinpaiLogo' + i + '">' +
							'<div class="layui-upload-list">' +
							'<div class="layui-upload-img" id="cardLo' + i + '" onclick="imgUp(' + i +
							')">' +
							'<img id="cardLoImg' + i + '" src="' + imageTexts[i].localImgUrl + '">' +
							'<div class="upTips">+<br />上传图片</div></div>' +
							'<div class="imgDel" data-id="cardLo' + i + '" style="display: none;">' +
							'<i class="layui-icon layui-unselect layui-tab-close">ဆ</i>' +
							'</div></div></div>' +
							'<textarea placeholder="图文内容建议上传商品、服务、环境等优质图片，并辅之以简单描述" id="imgText' + i +
							'" class="layui-textarea" onclick="textIn(' + i + ')">' + imageTexts[i].text +
							'</textarea><div class="delBtn delSale" data-id="' +
							i + '"><i class="layui-icon layui-unselect layui-tab-close">ဆ</i></div></li>'
					}
					$('#iwList').html(str)

					/*---------- 图文设置 ----------*/
					window.textIn = function(i) {
						$('#imgText' + i).on("input", function(e) {
							imageTexts[i].text = e.delegateTarget.value
						});
					}
					window.imgUp = function(i) {
						$('#upLogo' + i).click()
						imgNum = i
						$('.input_img').change(function() {
							layer.load(2, {
								shade: 0.5
							});
							uploadImg(this, function(data) {
								Imgbase = data
							});
							setTimeout(function() {
								var datas = {
									"imgBaseStr": Imgbase,
									"institutionNumber": "1004",
									"imgType": "0",
									"merchantNumber": "180913174959827"
								}
								// 发送请求
								$.ajax({
									type: "post",
									url: CmsConfig.ServiceUrl.ApiRootUrlMeb + CmsConfig.addressUrl.Mervip.uploadImg,
									data: JSON.stringify(datas),
									dataType: "json",
									headers: {
										"Content-Type": "application/json"
									},
									success: function(data) {
										layer.closeAll('loading');
										if (data.code === 1000) {
											imageTexts[imgNum].imageId = data.data.imageId
											imageTexts[imgNum].localImgUrl = data.data.localImgUrl
											$('#cardLoImg' + imgNum).attr('src', data.data.localImgUrl);
											$('#cardLo' + imgNum).find('.upTips').hide();
										}
									}
								});
							}, 300)
						});
					}
					window.imgDel = function(i) {
						$('.layui-upload-img').on({
							mouseover: function() {
								var cardId = $(this).attr("id")
								var cardSrc = $('#' + cardId + 'Img' + i).attr("src")
								if (cardId === 'cardLo' && cardSrc) {
									$('.pinpaiLogo .imgDel').css({
										"display": "block",
										"opacity": 1
									})
								}
							}
						})
						$('.imgDel').on({
							mouseleave: function() {
								$('.imgDel').css({
									"display": "none",
									"opacity": 0
								})
							}
						})
						$('.imgDel').click(function(e) {
							var delId = e.currentTarget.dataset.id
							if (delId == 'cardLo' + i) {
								$('#cardLo' + i).find('img').remove()
								$(this).prev().find(".upTips").show()
							}
							$(this).hide()
						})
					}
				}
				saleListFor()

				$('#addSale').click(function() {
					var newO = new Object()
					newO.text = ''
					newO.imageId = ''
					newO.localImgUrl = '../../public/images/default.png'
					imageTexts.push(newO)
					saleListFor()
					cli()
					char()
					give()
				})

				function cli() {
					$('.delSale').click(function(e) {
						if (imageTexts.length == 1) {
							layer.msg('最少要保留一条图文信息')
							return
						}
						var data = this
						var num = data.getAttribute('data-id')
						imageTexts.splice(num, 1)
						saleListFor()
						cli()
						char()
						give()
					})
				}

				function char() {
					$('.charge').bind("input propertychange", function(event) {
						imageTexts[this.dataset.id].text = this.value
					})
				}

				function give() {
					$('.give').bind("input propertychange", function(event) {
						imageTexts[this.dataset.id].imageId = this.value
					})
				}
				give()
				char()
				cli()

				/*---------- 单选复选监听 ----------*/
				form.on('checkbox(columnDisplay)', function(data) {
					if ($("input[name='columnDisplay']:checked").length > 3) {
						$(this).prop("checked", false);
						form.render('checkbox');
						layer.msg("最多只能选择3个标签", function() {});
					} else {
						var checkNum = columnDVal.indexOf(data.elem.value)
						if (data.elem.checked) {
							$('.card_qListli').eq(checkNum).addClass('lishow');
						} else {
							$('.card_qListli').eq(checkNum).removeClass('lishow')
						}
					}
				});
				form.on('radio(tmType)', function(data) {
					if (data.value == 0) {
						$('.tmType0').show()
						$('.tmType1').hide()
					} else if (data.value == 1) {
						$('.tmType0').hide()
						$('.tmType1').show()
					}
				});

				// 自定义入口一
				form.on('switch(custom1Bodysw)', function(data) {
					if (data.elem.checked == true) {
						$('.custom1Body').show()
					} else if (data.elem.checked == false) {
						$('.custom1Body').hide()
					}
				});
				form.on('radio(custom1)', function(data) {
					console.log(data.value)
					if (data.value == 0) {
						$('.custom1B').hide()
						$('#custom1lNInput').val('')
						$('#custom1lNInput').removeAttr('lay-verify')
						$('#custom1lLInput').removeAttr('lay-verify')
						$('#custom1mIInput').removeAttr('lay-verify')
						$('#custom1mPInput').removeAttr('lay-verify')
						$('#custom1mYInput').removeAttr('lay-verify')
						$('.card_fListli').eq(0).hide()
					} else if (data.value == 1) {
						$('.card_fListli').eq(0).show()
						$('.custom1B').show()
						$('.custom1-link').show()
						$('.custom1-miniapp').hide()
						$('#custom1lNInput').attr('lay-verify', 'entryname')
						$('#custom1lLInput').attr('lay-verify', 'customlLInput')
						$('#custom1mIInput').removeAttr('lay-verify')
						$('#custom1mPInput').removeAttr('lay-verify')
						$('#custom1mYInput').attr('lay-verify', 'guideTips')
					} else if (data.value == 2) {
						$('.card_fListli').eq(0).show()
						$('.custom1B').show()
						$('.custom1-link').hide()
						$('.custom1-miniapp').show()
						$('#custom1lNInput').attr('lay-verify', 'entryname')
						$('#custom1lLInput').removeAttr('lay-verify')
						$('#custom1mIInput').attr('lay-verify', 'custommIInput')
						$('#custom1mPInput').attr('lay-verify', 'custommPInput')
						$('#custom1mYInput').attr('lay-verify', 'guideTips')
					}
				});
				$("#custom1lNInput").on("input", function(e) {
					if (e.delegateTarget.value == '') {
						$('.card_fListli').eq(0).find('p').html('自定义入口一')
					} else {
						$('.card_fListli').eq(0).find('p').html(e.delegateTarget.value)
					}
				});
				$("#custom1mYInput").on("input", function(e) {
					if (e.delegateTarget.value == '') {
						$('.card_fListli').eq(0).find('span').html('')
					} else {
						$('.card_fListli').eq(0).find('span').html(e.delegateTarget.value)
					}
				});
				// 自定义入口二
				form.on('switch(custom2Bodysw)', function(data) {
					if (data.elem.checked == true) {
						$('.custom2Body').show()
					} else if (data.elem.checked == false) {
						$('.custom2Body').hide()
					}
				});
				form.on('radio(custom2)', function(data) {
					if (data.value == 0) {
						$('.custom2B').hide()
						$('#custom2lNInput').val('')
						$('#custom2lNInput').removeAttr('lay-verify')
						$('#custom2lLInput').removeAttr('lay-verify')
						$('#custom2mIInput').removeAttr('lay-verify')
						$('#custom2mPInput').removeAttr('lay-verify')
						$('#custom2mYInput').removeAttr('lay-verify')
						$('.card_fListli').eq(1).hide()
					} else if (data.value == 1) {
						$('.card_fListli').eq(1).show()
						$('.custom2B').show()
						$('.custom2-link').show()
						$('.custom2-miniapp').hide()
						$('#custom2lNInput').attr('lay-verify', 'entryname')
						$('#custom2lLInput').attr('lay-verify', 'customlLInput')
						$('#custom2mIInput').removeAttr('lay-verify')
						$('#custom2mPInput').removeAttr('lay-verify')
						$('#custom2mYInput').attr('lay-verify', 'guideTips')
					} else if (data.value == 2) {
						$('.card_fListli').eq(1).show()
						$('.custom2B').show()
						$('.custom2-link').hide()
						$('.custom2-miniapp').show()
						$('#custom2lNInput').attr('lay-verify', 'entryname')
						$('#custom2lLInput').removeAttr('lay-verify')
						$('#custom2mIInput').attr('lay-verify', 'custommIInput')
						$('#custom2mPInput').attr('lay-verify', 'custommPInput')
						$('#custom2mYInput').attr('lay-verify', 'guideTips')
					}
				});
				$("#custom2lNInput").on("input", function(e) {
					if (e.delegateTarget.value == '') {
						$('.card_fListli').eq(1).find('p').html('自定义入口二')
					} else {
						$('.card_fListli').eq(1).find('p').html(e.delegateTarget.value)
					}
				});
				$("#custom2mYInput").on("input", function(e) {
					if (e.delegateTarget.value == '') {
						$('.card_fListli').eq(1).find('span').html('')
					} else {
						$('.card_fListli').eq(1).find('span').html(e.delegateTarget.value)
					}
				});

				/*---------- Input监听 ----------*/
				ltname()

				/*---------- 自定义验证规则 ----------*/
				form.verify({
					ltName: function(value) {
						if (value == '') {
							return '副标题不能为空！'
						} else if (value != '') {
							if (value.length > 5) {
								return '副标题不能超过5个字符！'
							}
						}
					},
					guideTips: function(value) {
						if (value != '') {
							if (value.length > 5) {
								return '引导语不能超过5个字符'
							}
						}
					},
					customlLInput: function(value) {
						if (value == '') {
							return '自定义链接不能为空！'
						}
					},
					custommIInput: function(value) {
						if (value == '') {
							return '小程序ID不能为空！'
						}
					},
					custommPInput: function(value) {
						if (value == '') {
							return '小程序页面地址不能为空！'
						}
					},
					entryname: function(value) {
						if (value == '') {
							return '入口名称不能为空！'
						}
						if (value.length > 5) {
							return '入口名称不能超过5个字符'
						}
					},
				});

				//表单初始赋值
				function setcardCon(cardCon) {
					form.val('basic', {

					})
					ltname()
					layer.closeAll('loading');
				}
				//监听提交
				form.on('submit(add)', function(data) {
					customs = []
					var data = data.field
					// layer.alert(JSON.stringify(data.field), {
					//  title: '最终的提交信息'
					// })
					for (var i = 1; i < 4; i++) {
						var customNamel = new Object()
						customNamel.customNo = i
						customNamel.customState = data['custom' + i]
						customNamel.customName = data['custom' + i + 'lNInput']
						customNamel.customLink = data['custom' + i + 'lLInput']
						customNamel.leadingInfo = data['custom' + i + 'mYInput']
						customNamel.appletId = data['custom' + i + 'mIInput']
						customNamel.appletLink = data['custom' + i + 'mPInput']
						customs.push(customNamel)
					}
					data.customs = customs
					data.imageTexts = imageTexts

					var arrc = new Array();
					var arrm = new Array();
					$("input:checkbox[name='columnDisplay']:checked").each(function(i) {
						arrc[i] = $(this).val();
					});
					$("input:checkbox[name='merchantService']:checked").each(function(i) {
						arrm[i] = $(this).val();
					});
					data.columnDisplay = arrc.join('||');
					data.merchantService = arrm.join('||');
					data.institutionNumber = insNumber
					data.merchantNumber = merNumber
					// data.applyShops = shopNumbers
					data.applyShops = []
					if (shopNumbers != '') {
						data.shopJurisdiction = 1
					} else {
						data.shopJurisdiction = 0
					}
					console.log(data)
					layer.load(2, {
						shade: 0.5
					});
					// return
					// 发送请求
					$.ajax({
						type: "post",
						url: CmsConfig.ServiceUrl.ApiRootUrlMeb + CmsConfig.addressUrl.Mervip.addWCard,
						data: JSON.stringify(data),
						dataType: "json",
						headers: {
							"Content-Type": "application/json"
						},
						success: function(data) {
							if (data.code === 1000) {
								layer.closeAll('loading');
								parent.layer.msg(data.msg)
								location.replace(location.href)
							} else {
								layer.closeAll('loading');
								parent.layer.msg(data.msg)
							}
						}
					});
					return false;
				});
			});
			$('.card_qListli').click(function(e) {
				chooseCnum = $('.card_qListli').index(this) + 1
			})

			$('.chooseColor span').click(function(e) {
				chooseCnum = $('.chooseColor span').index(this) + 1
				$(this).siblings('span').removeClass('chooseCC layui-icon layui-icon-ok')
				$(this).addClass('chooseCC layui-icon layui-icon-ok')
				$('.card_b').attr("class", 'card_b card_bc' + chooseCnum)
			})

			function ltname() {
				$('.ltN').text($("#ltName").val())
				$('.ltNamepv').text($("#ltNamefu").val())
				$("#ltName").on("input", function(e) {
					//获取input输入的值
					$('.ltN').text(e.delegateTarget.value)
				});
				$("#ltNamefu").on("input", function(e) {
					//获取input输入的值
					$('.ltNamepv').text(e.delegateTarget.value)
				});
			}

			function uploadImg(input_file, get_data) {
				/*input_file：文件按钮对象*/
				/*get_data: 转换成功后执行的方法*/
				if (typeof(FileReader) === 'undefined') {
					alert("抱歉，你的浏览器不支持 FileReader，不能将图片转换为Base64，请使用现代浏览器操作！");
				} else {
					try {
						/*图片转Base64 核心代码*/
						var file = input_file.files[0];
						//这里我们判断下类型如果不是图片就返回 去掉就可以上传任意文件
						if (!/image\/\w+/.test(file.type)) {
							alert("请确保文件为图像类型");
							return false;
						}
						var reader = new FileReader();
						reader.onload = function() {
							get_data(this.result);
						}
						reader.readAsDataURL(file);
					} catch (e) {
						alert('图片转Base64出错啦！' + e.toString())
					}
				}
			}
		</script>
	</body>

</html>
