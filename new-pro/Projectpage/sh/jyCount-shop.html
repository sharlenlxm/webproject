<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=0">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <link rel="stylesheet" href="../../public/css/style-baobiao1.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <script type="text/javascript">
    // $(function() {
    // 	$.ajax({
    // 		type: 'POST',
    // 		async: true,
    // 		url: ".getqudao",
    // 		success: function(data) {
    // 			for(var i = 0; i < data.length; i++) {
    // 				$("#payment").append("<option value='" + data[i].Passageway + "'>" + data[i].PassagewayC + "</option>");
    // 			}
    // 			form.render();
    // 		}
    // 	});
    // })
    </script>
    <style type="text/css">
    .clearfix:after {
        display: block;
        content: "";
        clear: both;
    }
    </style>
</head>

<body>
    <div class="x-nav">
        <!-- <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a><cite>概览统计</cite></a>
        </span> -->
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
            <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body" style="overflow:auto">
        <div class="layui-row layui-form x-so">
        	<!-- <div class="layui-input-inline">
                
                <select name="shopName" id="shopName" lay-search>
                    <option value="">--请选择门店--</option>
                </select>
            </div> -->
            <div class="layui-input-inline">
                <input type="text" class="layui-input" placeholder="开始时间" name="" id="startTime">
            </div>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" placeholder="截止时间" name="" id="endTime">
            </div>
            <div class="layui-input-inline">
                <button class="layui-btn" lay-submit="" lay-filter="sreach" title="搜索" id="btn1"><i class="layui-icon">&#xe615;</i></button>
            </div>
        </div>
      	<div class="baobiao" style="width:100%;height:143px">
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        合计
                    </div>
                    <div style="line-height:50px;font-size:16px" id="hejiTotalMoney">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        收银
                    </div>
                    <div style="line-height:50px;font-size:16px" id="shouYinTotalMoney">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        充值
                    </div>
                    <div style="line-height:50px;font-size:16px" id="chongZhiTotalMoney">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        会员购买
                    </div>
                    <div style="line-height:50px;font-size:16px" id="huiyuanTotalMoney">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        付费卡券
                    </div>
                    <div style="line-height:50px;font-size:16px" id="fufeikaquanTotalMoney">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        次/月卡
                    </div>
                    <div style="line-height:50px;font-size:16px" id="ciyuekaTotalMoney">
                        0
                    </div>
                </div>
            </div>
        </div>
      
        <div class="layui-tab layui-tab-card">
            <ul class="layui-tab-title">
                <li class="layui-this qiehuan" style="width:90px" onclick="tab(0)">收银</li>
                <li style="width:90px" class="qiehuan" onclick="tab(1)">充值</li>
                <li style="width:90px" class="qiehuan" onclick="tab(2)">会员购买</li>
                <li style="width:90px" class="qiehuan" onclick="tab(3)">付费卡券</li>
                <li style="width:90px" class="qiehuan" onclick="tab(4)">次/月卡</li>
            </ul>
        </div>
        <div class="grid-demo border">
            <div id="main" style="height: 400px"></div>
        </div>
        <table class="layui-table" id="table1" lay-filter="useruv"></table>
    </div>
</body>
<script src="../../common/config-sh.js"></script>
<script src="../../common/utility.js"></script>
<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
<script>
var userNumber = JSON.parse(sessionStorage.getItem('userSh')).Number;
var agentLevel = JSON.parse(sessionStorage.getItem('userSh')).agentLevel;
var Statement_Date = []
var orderTotalMoney = []
var orderCount = []
var orderMoney = []
var refundMoney = []
var shouxuMoney = []
var shishou = []
var myChart
var option
	function change(data){
		sjData = data
		return data.list
	}
function fun_date(aa) {
    var date1 = new Date(),
        time1 = date1.getFullYear() + "-" + (date1.getMonth() + 1) + "-" + date1.getDate(); //time1表示当前时间
    var date2 = new Date(date1);
    date2.setDate(date1.getDate() + aa);
    var time2 = date2.getFullYear() + "-" + (date2.getMonth() + 1) + "-" + date2.getDate();

    var a = time2.split('-')[0],
        b = time2.split('-')[1],
        c = time2.split('-')[2]
    if (b < 10) {
        b = 0 + b
    }
    if (c < 10) {
        c = 0 + c
    }
    return a + '-' + b + '-' + c
}

function tab(id) {
    switch (id) {
        case 0:

            CmsUtility.clearListArr(orderTotalMoney)
            for (let i = 0; i < orderMoney.length; i++) {
                orderTotalMoney.push(orderMoney[i])
            }
            console.log()
            myChart.clear()
            myChart.setOption(option);
            // statements_1
            break;
        case 1:
            CmsUtility.clearListArr(orderTotalMoney)
            for (let i = 0; i < orderCount.length; i++) {
                orderTotalMoney.push(orderCount[i])
            }

            myChart.clear()
            myChart.setOption(option);
            // statements_1
            break;
        case 2:

            CmsUtility.clearListArr(orderTotalMoney)
            for (let i = 0; i < refundMoney.length; i++) {
                orderTotalMoney.push(refundMoney[i])
            }

            myChart.clear()
            myChart.setOption(option);
            // statements_1
            break;
        case 3:

            CmsUtility.clearListArr(orderTotalMoney)
            for (let i = 0; i < shouxuMoney.length; i++) {
                orderTotalMoney.push(shouxuMoney[i])
            }

            myChart.clear()
            myChart.setOption(option);
            // statements_1
            break;
        case 4:

            CmsUtility.clearListArr(orderTotalMoney)
            for (let i = 0; i < shishou.length; i++) {
                orderTotalMoney.push(shishou[i])
            }

            myChart.clear()
            myChart.setOption(option);
            // statements_1
            break;
        default:
            // statements_def
            break;
    }
}
//列表
layui.use('laydate', function() {
    var laydate = layui.laydate;
    laydate.render({
        elem: '#startTime', //指定元素
        value: fun_date(-6)


    });
    laydate.render({
        elem: '#endTime',
        value: fun_date(0)

    });

    laydate.render({
        elem: '#startTime1', //指定元素
        value: fun_date(-6)

    });
    laydate.render({
        elem: '#endTime1',
        value: fun_date(0)
    });

});
layui.use(['form', 'table', 'laytpl'], function() {
    var table = layui.table,
        form = layui.form,
        laytpl = layui.laytpl,
        $ = layui.jquery;
        var dataO = new Object();
    dataO.merchantNumber = userNumber
         CmsUtility.postAjaxCall(
            CmsConfig.addressUrl.Merchant.getShopNames,
            dataO,
            function(data) {
                var shopData = data.data
                for (var i = 0; i < shopData.length; i++) {
                    $("#shopName").append("<option value='" + shopData[i].shopNumber  + "'>" + shopData[i].shopName + '/' + shopData[i].shopNumber + "</option>");
                }
                form.render()
            }
        )
   
    //var index = layer.load(2, { shade: [0.4, '#393D49'] })

    
    function reloadres() {
        var index = layer.load(2, { shade: [0.4, '#393D49'] })
        CmsUtility.postAjaxCall(
            //系统设置
            'statistics/getOperateStatistics', {
                "merchantNumber": userNumber,
                "type": '1',
                "startTime": $('#startTime').val(),
                "endTime": $('#endTime').val(),
                "shopNumber": '',
                "clerkNumber":'',
                "payTypes":'0#1#2#3#4#5',
                "modelTypes":'0#1#2#3#4',
                "page":'1',
                "limit":'200'
            },
            function(data) {
                layer.closeAll()
                CmsUtility.clearListArr(Statement_Date)
                CmsUtility.clearListArr(orderTotalMoney)
                CmsUtility.clearListArr(orderCount)
                CmsUtility.clearListArr(orderMoney)
                CmsUtility.clearListArr(refundMoney)
                CmsUtility.clearListArr(shouxuMoney)
                CmsUtility.clearListArr(shishou)
                $("#hejiTotalMoney").html(data.data.hejiTotalMoney)
				$("#shouYinTotalMoney").html(data.data.shouYinTotalMoney)
				$("#chongZhiTotalMoney").html(data.data.chongZhiTotalMoney)
				$("#huiyuanTotalMoney").html(data.data.huiyuanTotalMoney)
				$("#fufeikaquanTotalMoney").html(data.data.fufeikaquanTotalMoney)
				$("#ciyuekaTotalMoney").html(data.data.ciyuekaTotalMoney)
                var data = data.data.list
                for (var j = 0; j < data.length; j++) {
                    Statement_Date.push(data[j].statementDate)
                    orderTotalMoney.push(data[j].shouYinMoney)
                    orderMoney.push(data[j].shouYinMoney)
                    orderCount.push(data[j].chongZhiMoney)
                    refundMoney.push(data[j].huiyuanMoney)
                    shouxuMoney.push(data[j].fufeikaquanMoney)
                    shishou.push(data[j].ciyuekaMoney)
                }

                Statement_Date.sort()
                myChart.clear()
                // 为echarts对象加载数据
                myChart.setOption(option);
            },
            function(data) {
                console.log('222')
            }
        )
    }
    setTimeout(function() {
        reloadres()
    }, 500)
    var sjData
    //方法级渲染
    function tableRender() {
        table.render({
            elem: '#table1',
            url: CmsConfig.ServiceUrl.ApiRootUrl + 'statistics/getOperateStatistics',
            where: {
                "merchantNumber": userNumber,
                "type": '1',
                "startTime": $('#startTime').val(),
                "endTime": $('#endTime').val(),
                "shopNumber": '',
                "clerkNumber":'',
                "payTypes":'0#1#2#3#4#5',
                "modelTypes":'0#1#2#3#4',
            },
            page: true,
            limits: [10, 20],
            method: "post",
            id: 'tradeInfo',
            response: {
                //res 即为原始返回的数据
                "statusCode": "1000", //解析接口状态

            },
            parseData: function(res) {
                console.log(res)
                //res 即为原始返回的数据
                if (res.data == null) {
                    return
                }
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.msg, //解析提示文本
                    "count": res.data.count, //解析数据长度
                    "data": change(res.data), //解析数据列表
                };
            },
            cols: [
                [{
                    field: 'shopName',
                    title: '门店',
                    align: 'center'
                }, {
                    field: 'hejiMoney',
                    title: '合计',
                    align: 'center'
                }, {
                    field: 'shouYinMoney',
                    title: '收银',
                    align: 'center'
                }, {
                    field: 'chongZhiMoney',
                    title: '充值',
                    align: 'center'
                }, {
                    field: 'huiyuanMoney',
                    title: '会员购买',
                    align: 'center'
                }, {
                    field: 'fufeikaquanMoney',
                    title: '付费卡券',
                    align: 'center',
                }, {
                    field: 'ciyuekaMoney',
                    title: '次/月卡',
                    align: 'center'
                }]
            ],
            done: function(data,data1,data2) {
                layer.closeAll()
                console.log(data.data)
				                
            }
        })
    }
    setTimeout(function() {
        tableRender()
    }, 500)

    $('#search').click(function() {
        tableRender()
        reloadres()
    })
    $('#btn1').click(function() {
        console.log('111')
        tableRender()
        reloadres()
        console.log($('.qiehuan'))
        var qiehuan = document.getElementsByClassName('qiehuan')
        for (let i = 0; i < qiehuan.length; i++) {
            qiehuan[i].setAttribute('class', 'qiehuan')
        }
        qiehuan[0].setAttribute('class', 'layui-this qiehuan')
    })
    myChart = echarts.init(document.getElementById('main'));
    option = {
        grid: {
            x: 70,
            x2: 20,
            y: 70,
            y2: 40,
            borderWidth: 1
        },
        title: '',
        tooltip: {
            trigger: 'axis',
            axisPointer: {
                type: 'cross'
            }
        },
        legend: {
            data: ['金额']
        },
        calculable: true,
        xAxis: [{
            type: 'category',
            axisTick: {
                alignWithLabel: true
            },
            axisLine: {
                onZero: false
            },
            data: Statement_Date
        }],
        yAxis: [{
            splitLine: {
                show: true,
                lineStyle: {
                    type: "dashed",
                    color: "#dfdfdf"
                }
            },
            axisLabel: {
                textStyle: {
                    fontSize: 14,
                    color: '#5b6e89'
                }
            },
            type: 'value'
        }],
        series: [{
            name: '',
            type: 'line',
            smooth: true,
            itemStyle: {
                normal: {
                    areaStyle: {
                        type: 'default',
                        color: {
                            type: 'linear',
                            x: 0,
                            y: 0,
                            x2: 0,
                            y2: 1,
                            colorStops: [{
                                offset: 0,
                                color: '#6e94ff'
                            }, {
                                offset: 1,
                                color: '#ffffff'
                            }],
                            globalCoord: false
                        }
                    },
                    color: '#6e94ff'
                }
            },
            data: orderTotalMoney
        }]
    };
    // 根據條件重载表格
    // 	var $ = layui.$,
    // 		active = {
    // 			reload: function() {
    // 				// 获取上面查询框的值
    // 				var shopname = $("#shopname").val().trim();
    // 				var startTime = $("#startTime").val().trim();
    // 				var endTime = $("#endTime").val().trim();
    // 				var passway = $("#payment option:selected").val().trim();
    // 				//执行重载
    // 				table.reload('tradeInfo', {
    // 					page: {
    // 						curr: 1 //重新从第 1 页开始
    // 					},
    // 					where: {
    // 						shopname: shopname,
    // 						passway: passway
    // 					}
    // 				});
    // 			}
    // 		};

    // 	$('.layui-row .layui-btn').on('click', function() {
    // 		var type = $(this).data('type');
    // 		active[type] ? active[type].call(this) : '';
    // 	});
});
</script>

</html>