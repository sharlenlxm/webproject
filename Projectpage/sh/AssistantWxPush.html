<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>编辑</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css?v=1">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <style type="text/css">
    #qrcode{height:100%;}
	#qrimg{height:99%;display:block;margin:0 auto;}
      .qrtips{color: red;margin-left: 20px;}
      @media screen and (max-width: 450px){
        .layui-form-item .layui-input-inline{margin:0;text-align:center;}
     	.qrtips{margin-left: 0;}
      }
    </style>
</head>
<body>
	<div class="x-body">
        <form class="layui-form">
        	<input type="hidden" id="logGid" name="logGid" value="${logGid}"/>
          	<div class="layui-form-item">
              	<div class="layui-input-inline">
                  	<div id="qrcode">
						<img id="qrimg" src=".qrcode/servletImage.do?qrcodeurl=http://api.51shanhe.com/oneCodeAgain/openId?clerkNumber=${pd.ClerkNumber}">
					</div>
                  	<div class="qrtips">
						开通后随时随地查看经营情况
					</div>
              	</div>
          	</div>
          	<table class="layui-hide" id="table1" lay-filter="useruv"></table>
      	</form>
    </div>
    <script type="text/html" id="tool">
		<a class="layui-btn layui-btn-xs" lay-event="UntieWx">解绑</a>
	</script>
    <script>
    layui.use(['table', 'layer'], function() {
    	$ = layui.jquery;
        	var form = layui.form
        	,layer = layui.layer;

			var table = layui.table;
        	//方法级渲染
			table.render({
				elem: '#table1',
				url: '.clerk/getclerkwxpushList?ClerkNumber=${pd.ClerkNumber}',
				page: false,
				method: "post",
				id: 'deviceInfo',
				cols: [
					[{type:'checkbox'
					},{
						field: 'Wxnick',
						title: '昵称'
					}, {
						field: 'BandTime',
						title: '绑定时间',
						align: 'center'
					}, {
						title: '操作',
						align: 'center',
						toolbar: "#tool"
					}]
				]
			})
			table.on('tool(useruv)', function(obj){
				var mydata = {
						"ClerkNumber" : obj.data.ClerkNumber,
						"PushStatus" : 1
				}
				if (obj.event === 'UntieWx') {
					// 禁用分类
					layer.confirm('确定要解绑吗?', function(index) {
						// 发送请求
						$.ajax({
							type: "post",
							url: ".clerk/getpushStatus",
							async: true,
							data: mydata,
							success: function(data) {
								if(data.result == "success") {
									layer.msg("操作成功", {icon: 1,time:1000},function(){
										window.location.reload();
									});
								}else {
									layer.alert(data.msg, {
										icon: 6
									},function(){	
										return 
									});
								}
							}
						});
					});
				}
			})
      });
    </script>
</body>
</html>