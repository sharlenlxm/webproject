<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title></title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1, maximum-scale=1, user-scalable=0">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <link rel="stylesheet" href="../../public/css/style-baobiao.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <script type="text/javascript">
    // $(function() {
    // 	$.ajax({
    // 		type: 'POST',
    // 		async: true,
    // 		url: ".getqudao",
    // 		success: function(data) {
    // 			for(var i = 0; i < data.length; i++) {
    // 				$("#payment").append("<option value='" + data[i].Passageway + "'>" + data[i].PassagewayC + "</option>");
    // 			}
    // 			form.render();
    // 		}
    // 	});
    // })
    </script>
</head>

<body>
    <div class="x-nav">
        <span class="layui-breadcrumb">
				<a href="">商户</a>
				<a><cite>账单统计</cite></a>
			</span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
				<i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="x-body">
        <div class="layui-row layui-form x-so">
            <div class="layui-input-inline text">
                <div class="layui-input-clear"><i class="layui-icon layui-unselect layui-tab-close">ဆ</i></div>
                <input id="startTime" type="text" name="" placeholder="开始时间" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline text">
                <div class="layui-input-clear"><i class="layui-icon layui-unselect layui-tab-close">ဆ</i></div>
                <input id="endTime" type="text" name="" placeholder="结束时间" autocomplete="off" class="layui-input">
            </div>
            <div class="layui-input-inline">
                <select id="orderState" name="state">
                    <option value="">状态</option>
                    <option value="1">交易成功</option>
                    <option value="5">部分退款</option>
                    <option value="4">全额退款</option>
                </select>
            </div>
            <button class="layui-btn" id="search" title="搜索"><i class="layui-icon">&#xe615;</i></button>
        </div>
        <div class="baobiao">
            <div class="baobiao-col-1" style="padding-left: 0;width:19%">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        交易总笔数
                    </div>
                    <div style="line-height:50px;font-size:16px" id="Total_Order">
                        0
                    </div>
                </div>
            </div>
            <div class="baobiao-col-1" style="padding-left: 0;width:19%;padding-right:0">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        交易总金额
                    </div>
                    <div style="line-height:50px;font-size:16px" id="totalTransactionAmount">
                        0
                    </div>
                </div>
            </div>
            <div style="width:20px;height:143px;float:left;font-size: 50px;
    line-height: 154px;
    text-align: center;">-</div>
            <div class="baobiao-col-1" style="padding-left: 0;width:19%;padding-right:0">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        退款金额
                    </div>
                    <div style="line-height:50px;font-size:16px" id="refundAmount">
                        0元
                    </div>
                </div>
            </div>
            <div style="width:20px;height:143px;float:left;font-size: 50px;
    line-height: 154px;
    text-align: center;">-</div>
            <div class="baobiao-col-1" style="padding-left: 0;width:19%;padding-right:0">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        手续费
                    </div>
                    <div style="line-height:50px;font-size:16px" id="poundage">
                        0元
                    </div>
                </div>
            </div>
            <div style="width:20px;height:143px;float:left;font-size: 32px;
    line-height: 154px;
    text-align: center;">=</div>
            <div class="baobiao-col-1" style="padding-left: 0;width:19%">
                <div class="baobiaoK">
                    <div class="baobiaolist" style="line-height:52px;font-size:16px">
                        实收金额
                    </div>
                    <div style="line-height:50px;font-size:16px" id="actualAmount">
                        0元
                    </div>
                </div>
            </div>
        </div>
        <br /><br /><br />
        <!-- <div class="layui-row layui-form x-so">
				<div class="layui-input-inline">
					<input type="text" name="shopname" id="shopName" placeholder="商户名称" autocomplete="off" class="layui-input">
				</div>
				<div class="layui-input-inline">
					<select name="payment" id="transactionPayment">
						<option value="">所属渠道</option>
					</select>
				</div>
				<div class="layui-input-inline">
					<input type="text" class="layui-input" placeholder="开始时间" name="" id="startTime">
				</div>
				<div class="layui-input-inline">
					<input type="text" class="layui-input" placeholder="截止时间" name="" id="endTime">
				</div>
				<div class="layui-input-inline">
					<button class="layui-btn" lay-submit="" lay-filter="sreach"  title="搜索" id="btn1"><i class="layui-icon">&#xe615;</i></button>
				</div>
			</div> -->
        <table class="layui-table" id="table1" lay-filter="useruv"></table>
    </div>
</body>
<script src="../../common/config-agent.js"></script>
<script src="../../common/utility.js"></script>
<script>
function fun_date(aa) {
    var date1 = new Date(),
        time1 = date1.getFullYear() + "-" + (date1.getMonth() + 1) + "-" + date1.getDate(); //time1表示当前时间
    var date2 = new Date(date1);
    date2.setDate(date1.getDate() + aa);
    var time2 = date2.getFullYear() + "-" + (date2.getMonth() + 1) + "-" + date2.getDate();

    var a = time2.split('-')[0],
        b = time2.split('-')[1],
        c = time2.split('-')[2]
    if (b < 10) {
        b = 0 + b
    }
    if (c < 10) {
        c = 0 + c
    }
    return a + '-' + b + '-' + c
}

function subPageClerkpass(data, data1) {
    var jgData = data
    console.log(jgData)
    var userNumber = JSON.parse(sessionStorage.getItem('agentUser')).Number;
    var agentLevel = JSON.parse(sessionStorage.getItem('agentUser')).agentLevel;

    layui.use(['form', 'table', 'laytpl', 'laydate'], function() {
        var table = layui.table,
            form = layui.form,
            laydate = layui.laydate,
            laytpl = layui.laytpl,
            $ = layui.jquery;
        // CmsUtility.postAjaxCall(
        // 			//系统设置
        // 	CmsConfig.addressUrl.Mechanism.getPassageList,
        // 	{
        // 		"institutionNumber":JSON.parse(sessionStorage.getItem('agentUser')).institutionNumber
        // 	},
        // 	function(data){
        // 		if(data.data == null){
        // 			return
        // 		}
        // 		var str = '<option value="">所属渠道</option>'
        // 		for(var i =0 ; i<data.data.length;i++){
        // 			str += '<option value="'+ data.data[i].paymentChannel+'">'+data.data[i].paymentName+'</option>'
        // 		}
        // 		$('#transactionPayment').html(str)
        // 		form.render()
        // 	},
        // 	function(data){
        // 		console.log('222')
        // 	}
        // )
        var day1 = new Date();
        day1.setTime(day1.getTime() - 24 * 60 * 60 * 1000);
        var s1 = day1.getFullYear() + "-" + (day1.getMonth() + 1) + "-" + day1.getDate();
        laydate.render({
            elem: '#startTime', //指定元素

            value: fun_date(0)
        });
        laydate.render({
            elem: '#endTime',

            value: new Date()
        });

        function getInfo() {
            CmsUtility.postAjaxCall(
                //系统设置
                CmsConfig.addressUrl.Agent.getMerBatchInfoCollect, {
                    "merchantNumber": jgData.merchantNumber,
                    "startTime": $('#startTime').val(),
                    "endTime": $('#endTime').val(),
                    "orderState": $('#orderState').val(),
                    "page": 1,
                    "limit": 10
                },
                function(data) {
                    console.log(data)
                    if (data.data == null) {
                        $('#Total_Order').html(0)
                        $('#actualAmount').html('0元')
                        $('#poundage').html( '0元')
                        $('#refundAmount').html('0元')
                        $('#totalTransactionAmount').html('0元')
                    } else {
                        $('#Total_Order').html(data.data.merBatchInCollect.number)
                        $('#actualAmount').html(data.data.merBatchInCollect.actualAmount + '元')
                        $('#poundage').html(data.data.merBatchInCollect.poundage + '元')
                        $('#refundAmount').html(data.data.merBatchInCollect.refundAmount + '元')
                        $('#totalTransactionAmount').html(data.data.merBatchInCollect.totalTransactionAmount + '元')
                    }


                    // $('#brokerage1').html(data.data[0].actualAmount)
                    form.render()
                },
                function(data) {
                    console.log('222')
                }
            )
        }
        setTimeout(function() {
            getInfo()
        }, 500)
        //方法级渲染
        function tableRender() {
            var index = layer.load(2, { shade: [0.4, '#393D49'] })
            table.render({
                elem: '#table1',
                url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Agent.getMerBatchInfo + '?merchantNumber=' + jgData.merchantNumber,
                where: {
                    "startTime": $('#startTime').val(),
                    "endTime": $('#endTime').val(),
                    "orderState": $('#orderState').val()
                },
                page: true,
                limits: [10, 20],
                method: "post",
                id: 'tradeInfo',
                response: {
                    //res 即为原始返回的数据
                    "statusCode": "1000", //解析接口状态

                },
                parseData: function(res) {
                    console.log(res)
                    //res 即为原始返回的数据
                    if (res.data == null) {
                        return
                    }
                    return {
                        "code": res.code, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "count": res.data.count, //解析数据长度
                        "data": res.data.merBatchInfoList, //解析数据列表
                    };
                },
                cols: [
                    [{
                        field: 'batch',
                        title: '系统订单号',
                        align: 'center',
                        width: 250
                    }, {
                        field: 'transactionAmount',
                        title: '交易金额',
                        align: 'center',
                        templet: function(data) {
                            return '￥' + data.transactionAmount
                        }
                    }, {
                        field: 'shopPoundage',
                        title: '手续费',
                        align: 'center',
                        templet: function(data) {
                            return '￥' + data.shopPoundage
                        }
                    }, {
                        field: 'shishoujine',
                        title: '实际金额',
                        align: 'center',
                        templet: function(data) {
                            return '￥' + data.shishoujine
                        }
                    }, {
                        field: 'orderTime',
                        title: '提交时间',
                        align: 'center'
                    }, {
                        field: 'transactionTime',
                        title: '成功时间',
                        align: 'center'
                    }, {
                        field: 'orderState',
                        title: '状态',
                        align: 'center',
                    }]
                ],
                done: function(res, curr, count) {
                    console.log(res)
                    layer.closeAll();

                }
            })
        }
        setTimeout(function() {
            tableRender()
        }, 500)

        $('#search').click(function() {
            tableRender()
            getInfo()
        })


        // 根據條件重载表格
        var $ = layui.$,
            active = {
                reload: function() {
                    // 获取上面查询框的值
                    var shopname = $("#shopname").val();
                    var startTime = $("#startTime").val();
                    var endTime = $("#endTime").val();
                    var passway = $("#payment option:selected").val();
                    //执行重载
                    table.reload('tradeInfo', {
                        page: {
                            curr: 1 //重新从第 1 页开始
                        },
                        where: {
                            shopname: shopname,
                            passway: passway
                        }
                    });
                }
            };

        $('.layui-row .layui-btn').on('click', function() {
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });
    });
}



//列表
</script>
<script type="text/javascript">
</script>

</html>