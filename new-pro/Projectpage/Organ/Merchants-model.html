<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    #iosiframe {
        height: 100%;
    }

    .x-body {
        height: calc(100% - 40px);
        box-sizing: border-box;
        overflow: auto;
    }

    .layui-fluid {
        padding: 0;
    }

    .ThirdBody {
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, .2);
        border-radius: 4px;
        border-top: 1px solid #eee;
        border-left: 1px solid #eee;
        display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: space-between;
    }

    .ThirdList {
        border-bottom: 1px solid #eee;
        /* border-right: 1px solid #eee; */
        transition: all 0.35s;
        cursor: pointer;
    }

    .ThirdList:hover {
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, .2);
        z-index: 5000;
    }

    .layui-card-body {
        height: 150px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .ThirdListB {
        display: flex;
        align-items: center;
        flex-direction: column;
    }

    .ThirdListB img {
        width: 100px;
        height: 100px;
    }

    .ThirdListB p {
        margin-bottom: 10px;
    }

    .layui-form .layui-card-body {
        height: 180px;
    }
     .layui-col-md1 {
        width: 160px !important;
    }
    </style>
</head>

<body id="iosiframe">
    
    <div class="x-body">
        <!-- 第三方应用管理 -->
       
        <!-- 自有应用管理 -->
        <form class="layui-form" action="" lay-filter="cardAdd">
            <div class="layui-fluid">
               
                <div class="layui-row layui-col-space1 ThirdBody" style="margin-bottom:20px" id="listTop">
                    <!-- <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body" style="height:180px">
                                <div class="ThirdListB">
                                    <img src="../../public/images/yushouquan.jpg" style="width:50px;height:50px;margin:25px">
                                    <p>微信预授权</p>
                                    <input type="checkbox"  name="preLicensing" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="13" >
                                </div>
                            </div>
                        </div>
                    </div> -->
                    
                    
                    
                    
                    
                </div>
                 <div class="layui-row layui-col-space1 ThirdBody" id="listTop1">
                    
                   <!-- <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/ciyueka.png" style="width:50px;height:50px;margin:25px">
                                    <p>次/月卡系统</p>
                                    <input type="checkbox"  name="nextCard" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="5" >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/yingxiao.png" style="width:50px;height:50px;margin:25px">
                                    <p>营销系统</p>
                                    <input type="checkbox"  name="marketing" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="6" >
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-xs4 layui-col-md1 ThirdList">
                        <div class="layui-card">
                            <div class="layui-card-body">
                                <div class="ThirdListB">
                                    <img src="../../public/images/weixinfenzhang.png" style="width:50px;height:50px;margin:25px">
                                    <p>微信分账</p>
                                    <input type="checkbox"  name="wechatSeparate" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="8" >
                                </div>
                            </div>
                        </div>
                    </div>
                    
					<div class="layui-col-xs4 layui-col-md1 ThirdList" >
						<div class="layui-card">
							<div class="layui-card-body">
								<div class="ThirdListB">
									<img src="../../public/images/fapiao.png" style="width:50px;height:50px;margin:25px" >
									<p>电子发票</p>
									<input type="checkbox"  name="electronicInvoice" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="12" >
								</div>
							</div>
						</div>
					</div> -->
                </div>
        </form>
    </div>
    <script src="../../common/config-organ.js"></script>
    <script src="../../common/utility.js"></script>
    <script>
    var serverUrl = window.parent.serverUrl
    var userNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;
    var quanxianList = [
                    {
                        'img':'../../public/images/yushouquan.jpg',
                        'name':'微信预授权',
                        'type':13,
                        "cname":"preLicensing"
                    },
                    {
                        'img':'../../public/images/huabei.png',
                        'name':'花呗分期',
                        'type':7,
                        "cname":"huaBai"
                    },
                    {
                        'img':'../../public/images/huiyuanka.png',
                        'name':'会员卡系统',
                        'type':3,
                        "cname":"memberCard"
                    },
                    {
                        'img':'../../public/images/youhuiquan.png',
                        'name':'优惠券系统',
                        'type':4,
                        "cname":"coupon"
                    },
                    {
                        'img':'../../public/images/ciyueka.png',
                        'name':'次/月卡系统',
                        'type':5,
                        "cname":"nextCard"
                    },
                    {
                        'img':'../../public/images/yingxiao.png',
                        'name':'营销系统',
                        'type':6,
                        "cname":"marketing"
                    },
                    {
                        'img':'../../public/images/weixinfenzhang.png',
                        'name':'微信分账',
                        'type':8,
                        "cname":"wechatSeparate"
                    },
                    
                    {
                        'img':'../../public/images/fapiao.png',
                        'name':'电子发票',
                        'type':12,
                        "cname":"electronicInvoice"
                    },
    ]

    function subPage(data,data1){
        var jgData = data
        layui.use(['laydate', 'table', 'upload', 'form'], function() { //独立版的layer无需执行这一句
        var $ = layui.jquery,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            admin = layui.admin,
            element = layui.element,
            layer = layui.layer; //独立版的layer无需执行这一句
            CmsUtility.postAjaxCall(
                        //系统设置
                'bcrmIns/getInsAuthoritys',
                {
                "institutionNumber":userNumber
                },
                function(data){
                    if(data.code == 1000){
                        var apps = data.data.apps
                        for(var i = 0 ; i < quanxianList.length;i++){
                            for(var j = 0 ; j < apps.length;j++){
                                console.log(quanxianList[i].type, apps[j].type)
                                if(quanxianList[i].type == apps[j].type){
                                    if(apps[j].status == 1){
                                        quanxianList[i].onOff = false
                                        
                                    }else{
                                        quanxianList[i].onOff = true
                                    }
                                    
                                }
                            }
                        }
                        console.log(quanxianList)
                        var qxList = new Array()
                        for(var n = 0 ;n < quanxianList.length;n++){
                            if(quanxianList[n].onOff == true){
                                qxList.push(quanxianList[n])
                            }
                        }
                        if(qxList.length == 0){
                            layer.msg('暂无可用模块')
                            return
                        }
                        console.log(qxList.length)
                        if(qxList.length <=4){
                            var str = ''
                            for(var g = 0 ; g <qxList.length;g++){
                                str += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="'+ qxList[g].img +'" style="width:50px;height:50px;margin:25px"> <p>'+ qxList[g].name +'</p><input type="checkbox"  name="'+ qxList[g].cname  +'" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="'+ qxList[g].type +'" ></div> </div></div></div>'
                            }
                            console.log(str)
                            $('#listTop').html(str)
                            form.render()
                        }
                        if(qxList.length > 4){
                            var str = ''
                            for(var g = 0 ; g < 4;g++){
                                str += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="'+ qxList[g].img +'" style="width:50px;height:50px;margin:25px"> <p>'+ qxList[g].name +'</p><input type="checkbox"  name="'+ qxList[g].cname  +'" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="'+ qxList[g].type +'" ></div> </div></div></div>'
                            }
                            console.log(str)
                            $('#listTop').html(str)
                            var str1 = ''
                            for(var g = 4 ; g < qxList.length;g++){
                                str1 += '<div class="layui-col-xs4 layui-col-md1 ThirdList"><div class="layui-card"><div class="layui-card-body" style="height:180px"><div class="ThirdListB"><img src="'+ qxList[g].img +'" style="width:50px;height:50px;margin:25px"> <p>'+ qxList[g].name +'</p><input type="checkbox"  name="'+ qxList[g].cname  +'" lay-skin="switch" lay-filter="switchTest" title="开关" data-type="'+ qxList[g].type +'" ></div> </div></div></div>'
                            }
                            console.log(str1)
                            $('#listTop1').html(str1)
                            form.render()
                            var index = layer.load(2, {shade: [0.4, '#393D49']})
                             setTimeout(function(){
                                CmsUtility.postAjaxCall(
                //系统设置
                                'VeMerchant/getMerchantHaveApply',
                                {
                                    "merchantNumber":jgData.merchantNumber
                                },
                                function(data){
                                    if(data.code == 1000){
                                        var apps = data.data
                                        for(var i = 0 ; i < apps.length;i++){
                                            switch (apps[i].type ) {
                                                case 13:
                                                    form.val('cardAdd', {
                                                        
                                                        "preLicensing":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 7:
                                                    form.val('cardAdd', {
                                                        
                                                        "huaBai":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 3:
                                                    form.val('cardAdd', {
                                                        
                                                        "memberCard":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 4:
                                                    form.val('cardAdd', {
                                                        
                                                        "coupon":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 5:
                                                    form.val('cardAdd', {
                                                        
                                                        "nextCard":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 6:
                                                    form.val('cardAdd', {
                                                        
                                                        "marketing":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 8:
                                                    form.val('cardAdd', {
                                                        
                                                        "wechatSeparate":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                case 12:
                                                    form.val('cardAdd', {
                                                        
                                                        "electronicInvoice":apps[i].status == 0 ? true:false
                                                    })
                                                    break;
                                                default:
                                                    // statements_def
                                                    break;
                                            }
                                        }   
                                    }else{
                                        layer.msg(data.msg)
                                        
                                    }
                                    layer.closeAll()
                                },
                                function(data){
                                    console.log('222')
                                }
                            )
                             },500)
                        }
                    }else{
                        layer.msg(data.msg)
                    }
                },
                function(data){
                    console.log('222')
                }
            )
           
       
        form.on('switch(switchTest)', function(data) { //计次开关
            console.log(data)
            var tjData = new Object();
            tjData.merchantNumber = jgData.merchantNumber;
            tjData.type = data.elem.dataset.type
            tjData.status = this.checked ?'0':'1'
            CmsUtility.postAjaxCall(
                //系统设置
                'VeMerchant/updateMerchantHaveApply',
                tjData,
                function(data){
                    if(data.code == 1000){
                        
                        layer.msg('更改成功')
                        
                    }else{
                        layer.msg(data.msg)
                        
                    }
                },
                function(data){
                    console.log('222')
                }
            )
        });

    });
    }
    
    </script>
</body>

</html>