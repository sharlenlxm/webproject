<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../public/css/font.css">
		<link rel="stylesheet" href="../../public/css/xadmin.css">
		<script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
		<!-- <script type="text/javascript" src="../../public/js/vue.min.js"></script> -->
		<script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../public/js/xadmin.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
		<style type="text/css">
			.layui-btn+.layui-btn {
				margin-left: -2px;
			}

			.border {
				box-shadow: 0 0 30px rgba(0, 0, 0, .1);
				padding: 15px;
				box-sizing: border-box;
			}

			.huizongTit {
				font-size: 20px;
				margin-bottom: 20px;
			}

			.huizongCon {
				font-size: 20px;
			}

			.huizongCon span {
				font-size: 20px;
			}

			.col5 {
				width: 20% !important;
			}

			.col7 {
				width: 14.2857% !important;
			}

			.redTips {
				margin-left: 20px;
				color: red;
			}

		</style>
	</head>

	<body id="iosiframe">
		<div class="x-nav">
			<span class="layui-breadcrumb">
				<a href="">首页</a>
				<a href="">财务分析</a>
				<a><cite>通道统计分析</cite></a>
			</span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);"
			 title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
		</div>
		<div class="x-body">
			<form class="layui-form" lay-filter="report">
                <div class="layui-form-item">
                    <label class="layui-form-label">统计类型</label>
                    <div class="layui-input-block">
                        <input type="radio" name="wxType" value="1" title="商户分布" checked="" lay-filter="wxType">
                        <input type="radio" name="wxType" value="2" title="代理分布" lay-filter="wxType">
                        <input type="radio" name="wxType" value="2" title="会员分布" lay-filter="wxType">
                    </div>
                </div>
        </form>
		</div>
		
		<div class="x-body">
			<div class="grid-demo border" style="width:100%;overflow:auto">
			                <div id="main" style="height: 700px;width:100%"></div>
			            </div>
			
		</div>
		<script src="../../common/config.js"></script>
		<script src="../../common/utility.js"></script>
		<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts.min.js"></script>
		<script type="text/javascript" src="../../public/js/china.js"></script>
		<script>
			
			
			var myChart = echarts.init(document.getElementById('main'));
			function randomData() {  
			     return Math.round(Math.random()*500);  
			} 
			var mydata = [  
                {name: '北京',value: '100' },{name: '天津',value: randomData() },  
                {name: '上海',value: randomData() },{name: '重庆',value: randomData() },  
                {name: '河北',value: randomData() },{name: '河南',value: randomData() },  
                {name: '云南',value: randomData() },{name: '辽宁',value: randomData() },  
                {name: '黑龙江',value: randomData() },{name: '湖南',value: randomData() },  
                {name: '安徽',value: randomData() },{name: '山东',value: randomData() },  
                {name: '新疆',value: randomData() },{name: '江苏',value: randomData() },  
                {name: '浙江',value: randomData() },{name: '江西',value: randomData() },  
                {name: '湖北',value: randomData() },{name: '广西',value: randomData() },  
                {name: '甘肃',value: randomData() },{name: '山西',value: randomData() },  
                {name: '内蒙古',value: randomData() },{name: '陕西',value: randomData() },  
                {name: '吉林',value: randomData() },{name: '福建',value: randomData() },  
                {name: '贵州',value: randomData() },{name: '广东',value: randomData() },  
                {name: '青海',value: randomData() },{name: '西藏',value: randomData() },  
                {name: '四川',value: randomData() },{name: '宁夏',value: randomData() },  
                {name: '海南',value: randomData() },{name: '台湾',value: randomData() },  
                {name: '香港',value: randomData() },{name: '澳门',value: randomData() }  
            ];
            var optionMap = {  
                backgroundColor: '#FFFFFF',  
                title: {  
                    text: '机构数据统计',  
                    subtext: '',  
                    x:'center'  
                },  
                tooltip : {  
                    trigger: 'item'  
                },  
                
                //左侧小导航图标
                visualMap: {  
                    show : true,  
                    x: 'left',  
                    y: 'center',  
                    splitList: [   
                        {start: 500, end:600},{start: 400, end: 500},  
                        {start: 300, end: 400},{start: 200, end: 300},  
                        {start: 100, end: 200},{start: 0, end: 100},  
                    ],  
                    color: ['#5475f5', '#9feaa5', '#85daef','#74e2ca', '#e6ac53', '#9fb5ea']  
                },  
                
                //配置属性
                series: [{  
                    name: '数据',  
                    type: 'map',  
                    mapType: 'china',   
                    roam: true,  
                    label: {  
                        normal: {  
                            show: true  //省份名称  
                        },  
                        emphasis: {  
                            show: false  
                        }  
                    },  
                    data:mydata  //数据
                }]  
            };  
        //初始化echarts实例
        var myChart = echarts.init(document.getElementById('main'));

        //使用制定的配置项和数据显示图表
        myChart.setOption(optionMap);
			layui.use(['laydate', 'table', 'form', 'layer'], function() {
				var laydate = layui.laydate,
					table = layui.table,
					form = layui.form,
					layer = layui.layer;
				laydate.render({
					elem: '#startTime',
					value: startdate,
					max: enddate
				})
				laydate.render({
					elem: '#endTime',
					value: enddate,
					max: enddate
				})
				var option1 = {
				    title: {
				        text: '',
				        subtext: '',
				        left: 'center'
				    },
				    tooltip : {
				        trigger: 'item',
				        formatter: "{a} <br/>{b} : {c} ({d}%)"
				    },
				   
				    series : [
				        {
				            type: 'pie',
				            radius : '65%',
				            center: ['50%', '50%'],
				            selectedMode: 'single',
				            data:shCount,
				            itemStyle: {
				                emphasis: {
				                    shadowBlur: 10,
				                    shadowOffsetX: 0,
				                    shadowColor: 'rgba(0, 0, 0, 0.5)'
				                }
				            }
				        }
				    ]
				};
				var option = {
				    color: ['#3398DB'],
				    tooltip : {
				        trigger: 'axis',
				        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
				            type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
				        }
				    },
				    grid: {
				        left: '3%',
				        right: '4%',
				        bottom: '3%',
				        containLabel: true
				    },
				    xAxis : [
				        {
				            type : 'category',
				            data : shName,
				            axisTick: {
				                alignWithLabel: true
				            },
				            axisLabel: {  
                                     interval: 0,  
                                     formatter:function(value){  
                                           
                                         var ret = "";
                                         var maxLength = 2;
                                         var valLength = value.length;
                                         var rowN = Math.ceil(valLength / maxLength); 
                                         if (rowN > 1)  
                                         {  
                                             for (var i = 0; i < rowN; i++) {  
                                                 var temp = "";//每次截取的字符串  
                                                 var start = i * maxLength;//开始截取的位置  
                                                 var end = start + maxLength;//结束截取的位置  
                                                 //这里也可以加一个是否是最后一行的判断，但是不加也没有影响，那就不加吧  
                                                 temp = value.substring(start, end) + "\n";  
                                                 ret += temp; //凭借最终的字符串  
                                             }  
                                             return ret;  
                                         }  
                                         else {  
                                             return value;  
                                         }  
                                     }  
                                 }
				        }
				    ],
				    yAxis : [
				        {
				            type : 'value'
				        }
				    ],
				    series : [
				        {
				            name:'商户金额',
				            type:'bar',
				            barWidth: '60%',
				            data:shMoney
				        }
				    ]
				};
				
				function tableRender() {
					
					for(let i = 0 ; i < shName.length;i++){
			            shName.splice(i)
			        }
			        for(let i = 0 ; i < shMoney.length;i++){
			            shMoney.splice(i)
			        }
			        for(let i = 0 ; i < shCount.length;i++){
			            shCount.splice(i)
			        }
					//通道下商户金额前十 
					CmsUtility.postAjaxCall(
			            //系统设置
			            CmsConfig.addressUrl.Mechanism.getInsPayChMoney, {
			                "institutionNumber": userNumber,
							"paymentType": 2,
							"startTime": $('#startTime').val(),
							"endTime": $('#endTime').val(),
							"page":1,
							"limit":10
			            },
			            function(data) {
			            	
			                if (data.code == 1000) {
			                	var res = data.data
			     //                shName = []
								// shMoney = []
			                   for(var j = 0; j < res.length; j++) {
			                	shName.push(res[j].Merchant_Name)
			                	
			                	shMoney.push(res[j].orderMoney)
			                }
			                // 为echarts对象加载数据
			                myChart.clear()
			                myChart.setOption(option,'true');
			                } else {
			                    layer.msg(data.msg)
			                }
			            },
			            function(data) {
			                console.log('222')
			            }
			        )
					
					

					//富友数据
					//通道下商户金额前十  
					
					CmsUtility.postAjaxCall(
			            //系统设置
			            CmsConfig.addressUrl.Mechanism.getInsPayCount, {
			                "institutionNumber": userNumber,
							"paymentType": 2,
							"startTime": $('#startTime').val(),
							"endTime": $('#endTime').val(),
							"page":1,
							"limit":10
			            },
			            function(data) {
			            	
			                if (data.code == 1000) {
			                	var res = data.data
			                    // shCount = []
			                   for(var j = 0; j < res.length; j++) {
			                	var newO = new Object()
			                	newO.name = res[j].Merchant_Name
			                	newO.value = res[j].orderCount
			                	shCount.push(newO)
			                	
			                }
			                // 为echarts对象加载数据
			                myChart1.clear()
			                myChart1.setOption(option1,'true');
			                } else {
			                    layer.msg(data.msg)
			                }
			            },
			            function(data) {
			                console.log('222')
			            }
			        )
					//通道下商户交易笔数前十  
					
					//通道下商户补贴金额前十  
					table.render({
						url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getInsPayChSubMoney,
						where: {
							"institutionNumber": userNumber,
							"paymentType": 2,
							"startTime": $('#startTime').val(),
							"endTime": $('#endTime').val(),
						},
						elem: '#members_FY3',
						id: 'members_FY3',
						response: {
							//res 即为原始返回的数据
							"statusCode": "1000", //解析接口状态
						},
						parseData: function(res) { //res 即为原始返回的数据
							return {
								"code": res.code, //解析接口状态
								"msg": res.msg, //解析提示文本
								"count": res.count, //解析数据长度
								"data": res.data, //解析数据列表
							};
						},
						cols: [
							[{
								title: '排名',
								type: 'numbers'
							}, {
								align: 'center',
								field: 'Merchant_Name',
								title: '商户名称',
							}, {
								align: 'center',
								field: 'subsidyMoney',
								title: '补贴金额',
							}]
						],
						done: function(res, curr, count) {}
					});
					//通道下商户补贴笔数前十  
					table.render({
						url: CmsConfig.ServiceUrl.ApiRootUrl + CmsConfig.addressUrl.Mechanism.getInsPaySubCount,
						where: {
							"institutionNumber": userNumber,
							"paymentType": 2,
							"startTime": $('#startTime').val(),
							"endTime": $('#endTime').val(),
						},
						elem: '#members_FY4',
						id: 'members_FY4',
						response: {
							//res 即为原始返回的数据
							"statusCode": "1000", //解析接口状态
						},
						parseData: function(res) { //res 即为原始返回的数据
							return {
								"code": res.code, //解析接口状态
								"msg": res.msg, //解析提示文本
								"count": res.count, //解析数据长度
								"data": res.data, //解析数据列表
							};
						},
						cols: [
							[{
								title: '排名',
								type: 'numbers'
							}, {
								align: 'center',
								field: 'Merchant_Name',
								title: '商户名称',
							}, {
								align: 'center',
								field: 'subsidyCount',
								title: '补贴笔数',
							}]
						],
						done: function(res, curr, count) {}
					});

					

					
				}

				
			});
		</script>
	</body>

</html>
