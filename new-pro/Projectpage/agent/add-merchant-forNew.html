<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <script type="text/javascript" src="../../public/js/hangye.js"></script>
    <script type="text/javascript" src="../../public/js/hangye1.js"></script>
    <script type="text/javascript" src="../../public/js/yinhang.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        .widthauto {
                width: auto !important;
            }
            
            .tips_red {
                color: red;
            }
            
            .layui-form-label {
                padding-left: 0;
                width: 115px;
            }
            
            .layui-input-block {
                margin-left: 115px;
            }
            
            .layui-elem-quote {
                font-size: 18px;
            }
            
            .layui-elem-field legend {
                font-size: 16px;
            }
            
            .layui-upload-img {
                width: 200px;
                height: 200px;
                margin: 0 10px 10px 0;
            }
            
            .Since_inline {
                display: inline-block;
                width: auto !important;
                line-height: 38px;
            }
            
            .layui-elem-quote .layui-form-switch {
                margin: 0 15px;
                margin-top: 0;
            }
            img{
                text-align: center;
                height: 100%;
            }
            .yingyezhizhao{
                display:inline-block;width:500px;margin-left:30px
            }
            #showImgBox{
                width: 40%;
                height: 60%;
                position: fixed;
                z-index: 99999;
                display: none;
                background-color: #fff;
            }
            .showImg{
                
            }
        </style>
</head>

<body id="iosiframe">
    <div class="x-body">
        <div id="showImgBox" >
            <img id="showImg" src="http://sh-upfile.oss-cn-beijing.aliyuncs.com/1004/Merchant/1574146882000/c0b6baa3cad5d2f8cca8d5d5c6ac.jpeg" style="width:100%;height:100%">
        </div>  
        <div class="layui-row">
            <div class="layui-form" action="" lay-filter="cardAdd">
                <blockquote class="layui-elem-quote">商户信息</blockquote>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">图片信息</legend>
                </fieldset>
                <div class="layui-form-item layui-form-text" id="businessLicense1">
                    <!-- <label class="layui-form-label">营业执照</label> -->
                    <div class="layui-input-inline  noGeren" style="margin-left:30px;display: none">
                        <div class="layui-upload-img" >
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="businessLicense" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">营业执照</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="cashier" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">收银台照</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="placeBusiness" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">场景照</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="doorheadPhoto" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">门头照</div>
                    </div>
                </div>
                <!--隐藏-->
                <!--基本信息-->
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">文字信息</legend>
                </fieldset>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">商户类型</label>
                        <div class="layui-input-block widthauto">
                            <input type="radio" name="merchantType" value="0" title="个人" lay-filter="cardvalid" checked="">
                            <input type="radio" name="merchantType" value="1" title="个体" lay-filter="cardvalid">
                            <input type="radio" name="merchantType" value="2" title="企业" lay-filter="cardvalid">
                            <!-- <input type="text" disabled="" name="merchantType" lay-verify="title" autocomplete="off" placeholder="" class="layui-input"> -->
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">商户名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="merchantName" lay-verify="title" autocomplete="off" placeholder="请输入商户名称" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">客服手机号</label>
                        <div class="layui-input-block">
                            <input type="text" name="customerServiceTell" lay-verify="title" autocomplete="off" placeholder="请输入客服手机号" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" id="paymentType2" style="display:inline-block;width:auto;margin-left:30px">
                        <label class="layui-form-label">经营范围</label>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:0px;">
                            <select name="oneOperate" id="chOne" lay-filter="chOne" lay-verify="title">
                                <!-- <option value="">一级类目</option>
                                <option value="1">互联网</option>
                                <option value="2">科技</option> -->
                            </select>
                        </div>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:15px;">
                            <select name="twoOperate" id="chTwo" lay-filter="chTwo" lay-verify="">
                            </select>
                        </div>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:15px">
                            <select name="threeOperate" id="chThr" lay-filter="chThr" lay-verify="">
                            </select>
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">费率(%)</label>
                        <div class="layui-input-block">
                            <input type="text" name="rate" lay-verify="title" autocomplete="off" placeholder="请输入费率，例如0.38" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item noGeren yingyezhizhao"  style="display:none">
                        <label class="layui-form-label">营业执照名称</label>
                        <div class="layui-input-block">
                            <input type="text" name="businessLicenseName" lay-verify="title1" autocomplete="off" placeholder="请输入营业执照名称" class="layui-input">
                        </div>
                    </div>
                </div>
                <div class="box-item noGeren" style="display: none">
                    <div class="layui-form-item BLcn" style="display:inline-block;width:500px">
                        <label class="layui-form-label">营业执照编号</label>
                        <div class="layui-input-block">
                            <input type="text" name="businessLicenseNo" lay-verify="title1" autocomplete="off" placeholder="请输入营业执照编号" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;margin-left:30px">
                        <label class="layui-form-label">营业执照有限期</label>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:0px;">
                            <input type="text" name="businessLicenseTime" lay-verify="title1" autocomplete="off" placeholder="请选择营业执照有效期" class="layui-input" id="businessLicenseTime" >
                        </div>
                        <div style="width:30px;text-align:center;display:inline-block" class="yyNoChangqi">-</div>
                        <div class="layui-input-block yyNoChangqi" style="display:inline-block;width:200px;margin-left:5px;">
                            <input type="text" name="businessLicenseEndTime" lay-verify="title2" autocomplete="off" placeholder="请选择营业执照有效期" class="layui-input" id="businessLicenseEndTime">
                        </div>
                        <div class="layui-input-block" style="display:inline-block;margin-left:15px;vertical-align:top">
                            
                            <input type="checkbox" name="businessLicenseType" lay-skin="switch" lay-filter="businessLicenseType" lay-text="长期|非长期">
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item BLcn" style="display:inline-block;width:500px">
                        <label class="layui-form-label">邮箱</label>
                        <div class="layui-input-block">
                            <input type="text" name="mailbox" lay-verify="title" autocomplete="off" placeholder="请输入邮箱" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;margin-left:30px;vertical-align:top">
                        <label class="layui-form-label">是否开通云闪付</label>
                        <div class="layui-input-block" style="display:inline-block;margin-left:0px;vertical-align:top">
                            <!--  <input type="checkbox" name="isOpenYunPay" title="开通"> -->
                            <input type="checkbox" name="isOpenYunPay" lay-skin="switch" lay-filter="isOpenYunPay" lay-text="开通|不开通">
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item" id="paymentType2" style="display:inline-block;width:auto">
                        <label class="layui-form-label">公司地址</label>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:0px;">
                            <select name="prov1" id="prov" lay-filter="prov" lay-verify="title">
                                <!-- <option value="">一级类目</option>
                                <option value="1">互联网</option>
                                <option value="2">科技</option> -->
                            </select>
                        </div>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:15px;">
                            <select name="city1" id="city" lay-filter="city" lay-verify="">
                            </select>
                        </div>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:15px">
                            <select name="area1" id="area" lay-filter="area" lay-verify="">
                            </select>
                        </div>
                    </div>
                </div>
                <div class="layui-form-item" style="width:755px">
                    <label class="layui-form-label">商户详细地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="address" lay-verify="title" autocomplete="off" placeholder="请输入商户详细地址" class="layui-input">
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item BLcn" style="display:inline-block;width:500px">
                        <label class="layui-form-label">微信号</label>
                        <div class="layui-input-block">
                            <input type="text" name="weChatNo" lay-verify="" autocomplete="off" placeholder="请输入微信号" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item BLcn" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">支付宝号</label>
                        <div class="layui-input-block">
                            <input type="text" name="aliPayNo" lay-verify="" autocomplete="off" placeholder="请输入支付宝号" class="layui-input">
                        </div>
                    </div>
                </div>
                <blockquote class="layui-elem-quote">法人信息</blockquote>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">图片信息</legend>
                </fieldset>
                <div class="layui-form-item layui-form-text" id="businessLicense1">
                    <!-- <label class="layui-form-label">营业执照</label> -->
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="juridicalpersonIdPositive" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">身份证正面</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="juridicalpersonIdReverseside" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">身份证反面</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="holdId" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">手持身份证</div>
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">文字信息</legend>
                </fieldset>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">身份证号</label>
                        <div class="layui-input-block">
                            <input type="text" name="juridicalpersonId" lay-verify="title" autocomplete="off" placeholder="请输入身份证号" class="layui-input" id="juridicalpersonId">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-block">
                            <input type="text" name="juridicalpersonName" lay-verify="title" autocomplete="off" placeholder="请输入姓名" class="layui-input" id="juridicalpersonName">
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item BLcn" style="display:inline-block;width:500px">
                        <label class="layui-form-label">手机号</label>
                        <div class="layui-input-block">
                            <input type="text" name="registerCell" lay-verify="title" autocomplete="off" placeholder="请输入手机号" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;margin-left:30px">
                        <label class="layui-form-label">身份证有效期</label>
                        <div class="layui-input-block" style="display:inline-block;width:200px;margin-left:0px;">
                            <input type="text" name="juridicalpersonIdTime" lay-verify="title" autocomplete="off" placeholder="请选择身份证有效期" class="layui-input" id="juridicalpersonIdTime">
                        </div>
                        <div style="width:30px;text-align:center;display:inline-block" class="sfzNoChangqi">-</div>
                        <div class="layui-input-block sfzNoChangqi" style="display:inline-block;width:200px;margin-left:5px;">
                            <input type="text" name="juridicalPersonIDEndTime" lay-verify="" autocomplete="off" placeholder="请选择身份证有效期" class="layui-input" id="juridicalPersonIDEndTime">
                        </div>
                        <div class="layui-input-block" style="display:inline-block;margin-left:15px;vertical-align:top">
                            <input type="checkbox" name="juridicalPersonIDType" lay-skin="switch" lay-filter="juridicalPersonIDType" lay-text="长期|非长期">
                        </div>
                    </div>
                </div>
                <blockquote class="layui-elem-quote">结算信息</blockquote>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">图片信息</legend>
                </fieldset>
                <div class="layui-form-item layui-form-text" id="businessLicense1">
                    <!-- <label class="layui-form-label">营业执照</label> -->
                    <div class="layui-input-inline qiye" style="margin-left:30px;display:none">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="openingPermit" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">开户许可证</div>
                    </div>
                    <div class="layui-input-inline" style="margin-left:30px;">
                        <div class="layui-upload-img">
                            <img src="http://static.hongxiaosou.com/public/images/add.jpg" id="bankCardPositive" style="max-width: 100%;">
                        </div>
                        <div style="width:100%;text-align:center;">银行卡正面</div>
                    </div>
                </div>
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend style="font-weight: 500;">文字信息</legend>
                </fieldset>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">银行卡号</label>
                        <div class="layui-input-block">
                            <input type="text" name="bankCardNo" lay-verify="title" autocomplete="off" placeholder="请输入银行卡号" class="layui-input">
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">开户银行</label>
                        <div class="layui-input-block">
                            <!-- <input type="text" name="openingBank" lay-verify="title" autocomplete="off" placeholder="请输入开户银行" class="layui-input"> -->
                            <select name="openingBank1" lay-verify="openingBank" lay-search="" id="openingBank">
                            </select>
                        </div>
                    </div>
                </div>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">开户支行</label>
                        <div class="layui-input-block">
                            <input type="text" name="openingBankBranch" lay-verify="openingBankBranch" autocomplete="off" placeholder="请搜索并选择开户支行" class="layui-input" id="openingBankBranch" onblur="bl2()" onfocus="fc2()">
                            <div class="layui-input-block" style="position:absolute;top:34px;left:0;z-index:500;max-height:190px;overflow:auto;background-color:#fff;width:100%;margin-left:0;display:none" id="searchBox2">
                            </div>
                        </div>
                    </div>
                   <!--  <div class="layui-form-item" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">开户支行地区</label>
                        <div class="layui-input-block">
                            <input type="text" name="openingBankBranchAddress" lay-verify="title" autocomplete="off" placeholder="开户支行地区" class="layui-input">
                        </div>
                    </div> -->
                </div>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">预留手机号</label>
                        <div class="layui-input-block">
                            <input type="text" name="reserveCell" lay-verify="title" autocomplete="off" placeholder="请输入预留手机号" class="layui-input">
                        </div>
                    </div>
                </div>
                <blockquote class="layui-elem-quote">其他信息</blockquote>
                <div class="box-item">
                    <div class="layui-form-item" style="display:inline-block;width:500px">
                        <label class="layui-form-label">所属服务商</label>
                        <div class="layui-input-block">
                            <input type="text" name="agName" lay-verify="agentName" autocomplete="off" placeholder="请搜索并选择服务商" class="layui-input" id="agName" onblur="bl()" onfocus="fc()"  disabled="">
                            <div class="layui-input-block" style="position:absolute;top:34px;left:0;z-index:500;max-height:190px;overflow:auto;background-color:#fff;width:100%;margin-left:0;display:none" id="searchBox">
                                <!-- <div class="layui-btn layui-btn-primary" style="width:100%;margin-left:0" >121212</div>
                                    <div class="layui-btn layui-btn-primary" style="width:100%;margin-left:0" >121212</div>
                                    <div class="layui-btn layui-btn-primary" style="width:100%;margin-left:0" >121212</div>
                                    <div class="layui-btn layui-btn-primary" style="width:100%;margin-left:0" >121212</div>
                                    <div class="layui-btn layui-btn-primary" style="width:100%;margin-left:0" >121212</div> -->
                            </div>
                        </div>
                    </div>
                    <div class="layui-form-item" style="display:inline-block;width:500px;margin-left:30px">
                        <label class="layui-form-label">所属销售</label>
                        <div class="layui-input-block">
                            <input type="text" name="slName" lay-verify="saleName" autocomplete="off" placeholder="请搜索并选择销售" class="layui-input" id="slName" onblur="bl1()" onfocus="fc1()"  disabled="">
                            <div class="layui-input-block" style="position:absolute;top:34px;left:0;z-index:500;max-height:190px;overflow:auto;background-color:#fff;width:100%;margin-left:0;display:none" id="searchBox1">
                            </div>
                        </div>
                    </div>
                </div>
               <!--  <div class="box-item" style="margin-bottom:150px">
                    <div class="layui-form-item" style="display:inline-block">
                        <label class="layui-form-label">进件通道</label>
                        <div class="layui-input-block" id="paymentBox">
                        </div>
                    </div>
                </div> -->
                <div class="layui-form-item layui-layout-admin">
                    <div class="layui-input-block">
                        <div class="layui-footer" style="left: 0;text-align: center;">
                            <button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                            <button class="layui-btn layui-btn-primary" id="quxiao">取消</button>
                        </div>
                        <!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="../../common/config-agent.js"></script>
    <script src="../../common/utility.js"></script>
    <script>
    // var index = parent.layer.getFrameIndex(window.name);
    // $('#quxiao').click(function() {

    //     setTimeout(function() { parent.layer.close(index) }, 16);
    // })
    var userNumber = JSON.parse(sessionStorage.getItem('agentUser')).institutionNumber;
    var server = 'http://192.168.1.200:6005/shanhe-admin/'
    var operlistOne = []
    var operlistTwo = []
    var operlistThr = []
    var prov = []
    var city = []
    var area = []
    var longTime = Date.parse(new Date())
    var businessLicense = ''
    var cashier = ''
    var placeBusiness = ''
    var doorheadPhoto = ''
    var juridicalpersonIdPositive = ''
    var juridicalpersonIdReverseside = ''
    var holdId = ''
    var openingPermit = ''
    var bankCardPositive = ''
    var juridicalPersonIDType = 1
    var businessLicenseType = 1
    var isOpenYunPay = 1
    var merchantNumber = CmsUtility.getQueryString('merchantNumber')
    //var merchantNumber = '1004000563'
    var channelType = CmsUtility.getQueryString('type')
    var channelName = CmsUtility.getQueryString('name')
    var channel =  CmsUtility.getQueryString('channel')
    console.log(channelType,channelName,channel)
    var merInfo = ''
    var paymentInfo = ''
    var payList = ''
    var merType = 0
    var acctoken = sessionStorage.getItem('access_token')
    //判断是否有？
    function isWen(data){
        if(!data){
            return ''
        }
        if(data.indexOf('?')>=0){
            return data.split('?')[0]
        }else{
            return data
        }
    }
    $('.layui-upload-img').mouseover(function(){
         // console.log(this.getElementsByTagName('img')[0].getAttribute('src'))
         console.dir(this.childNodes[1])
         if(this.childNodes[1].currentSrc.indexOf('images/add.jpg')  >= 0 || this.childNodes[1].currentSrc == ''){
            return
         }
         $('#showImg').attr('src',this.childNodes[1].currentSrc)
         $('#showImgBox').css({
            'left':this.childNodes[1].x + 200,
            'top':this.childNodes[1].y
         })
         $('#showImgBox').show()
    })
    $('.layui-upload-img').mouseout(function(){
         // console.log(this.getElementsByTagName('img')[0].getAttribute('src'))
         // console.dir(this.childNodes[1])
         // $('#showImgBox').css({
         //    'left':this.childNodes[1].x + 200,
         //    'top':this.childNodes[1].y
         // })
         $('#showImgBox').hide()
    })
    function fourStr(data) {
        return data.substring(0, 4) + '-' + data.substring(4, 6) + '-' + data.substring(6, 8)
    }

    function bl() {
        setTimeout(function() {
            $('#searchBox').hide()
        }, 200)
        //$('#searchBox').hide()
    }

    function clickS(e) {
        $('#agName').val(e.getAttribute('data-name'))
        $('#agName').attr('agentNumber', e.getAttribute('data-id'))
        $('#agName').attr('agentType', e.getAttribute('data-level'))
        $('#searchBox').hide()
    }

    function fc() {
        $('#searchBox').show()
        CmsUtility.postAjaxCall2(
            //系统设置
            server + 'InsMer/getInsAgent', {

                "institutionNumber": userNumber,
                "agentNumber": JSON.parse(sessionStorage.getItem('agentUser')).Number,
                "agentName": $('#agName').val(),
                "page": 1,
                "limit": '100',
            },
            function(data) {
                console.log(this.value)
                if (data.code == 1000) {
                    var nb = new Object()
                    nb.agentNumber = JSON.parse(sessionStorage.getItem('agentUser')).Number
                    nb.agentName = JSON.parse(sessionStorage.getItem('agentUser')).agentName
                    data.data.agentlist.unshift(nb)
                    var str = ''
                    for (var i = 0; i < data.data.agentlist.length; i++) {
                        str += '<div class="layui-btn layui-btn-primary"  data-id="' + data.data.agentlist[i].agentNumber + '" data-name="' + data.data.agentlist[i].agentName + '" style="width:100%;margin-left:0" onclick="clickS(this)" >' + '[' + data.data.agentlist[i].agentNumber + ']' + data.data.agentlist[i].agentName + '</div>'
                    }
                    document.getElementById('searchBox').innerHTML = str

                    // layer.msg('保存成功')
                    // setTimeout(function(){
                    //  x_admin_close()
                    // },500);

                } else {
                    var nb = new Object()
                    nb.agentNumber = JSON.parse(sessionStorage.getItem('agentUser')).Number
                    nb.agentName = JSON.parse(sessionStorage.getItem('agentUser')).agentName
                    var str = ''
                    str = '<div class="layui-btn layui-btn-primary"  data-id="' + nb.agentNumber + '" data-name="' + nb.agentName + '" style="width:100%;margin-left:0" onclick="clickS(this)" >' + '[' + nb.agentNumber + ']' + nb.agentName + '</div>'

                    document.getElementById('searchBox').innerHTML = str
                }
            },
            function(data) {
                console.log('222')
            }
        )

    }

    function bl1() {
        setTimeout(function() {
            $('#searchBox1').hide()
        }, 200)
        //$('#searchBox').hide()
    }

    function clickS1(e) {
        $('#slName').val(e.getAttribute('data-name'))
        $('#slName').attr('saleNumber', e.getAttribute('data-id'))
        $('#searchBox1').hide()
    }

    function fc1() {
        if (!$('#agName').attr('agentnumber')) {
            layer.msg('请先选择服务商')
            return
        }
        $('#searchBox1').show()
        console.log($('#slName').val())
        CmsUtility.postAjaxCall2(
            //系统设置
            server + 'InsMer/getAgentSale', {

                "agentNumber": $('#agName').attr('agentnumber'),
                "saleName": $('#slName').val(),
                "page": 1,
                "limit": '100',
            },
            function(data) {
                console.log(this.value)
                if (data.code == 1000) {

                    var str = ''
                    console.log(data.data.agentSale)
                    for (var i = 0; i < data.data.agentSale.length; i++) {
                        str += '<div class="layui-btn layui-btn-primary" data-id="' + data.data.agentSale[i].saleNumber + '" data-name="' + data.data.agentSale[i].saleName + '" style="width:100%;margin-left:0" onclick="clickS1(this)" >' + '[' + data.data.agentSale[i].saleNumber + ']' + data.data.agentSale[i].saleName + '</div>'
                    }
                    document.getElementById('searchBox1').innerHTML = str

                    // layer.msg('保存成功')
                    // setTimeout(function(){
                    //  x_admin_close()
                    // },500);

                } else {
                    layer.msg(data.msg)
                    $('#searchBox1').hide()

                }
            },
            function(data) {
                console.log('222')
            }
        )

    }

    function bl2() {
        setTimeout(function() {
            $('#searchBox2').hide()
        }, 200)
        //$('#searchBox').hide()
    }

    function clickS2(e) {
        $('#openingBankBranch').val(e.getAttribute('data-name'))
        $('#openingBankBranch').attr('openingBankNumber', e.getAttribute('data-id'))
        $('#openingBankBranch').attr('openingBankName', e.getAttribute('data-name'))
        $('#searchBox2').hide()
    }

    function fc2() {

        if ($('#openingBank').val() == '') {
            layer.msg('请先选择开户银行')
            return
        }
        $('#searchBox2').show()

        CmsUtility.postAjaxCall2(
            //系统设置
            'https://nb.51shanhe.com/shanhe-common/cache/getBank', {
                "bankCode": $('#openingBank').val().split('|')[0],
                "paymentType": '4',
                "bankName": $('#openingBankBranch').val(),
                "page": 1,
                "limit": '100',
            },
            function(data) {
                console.log(this.value)
                if (data.code == 1000) {

                    var str = ''
                    for (var i = 0; i < data.data.selectBank.length; i++) {
                        str += '<div class="layui-btn layui-btn-primary" data-id="' + data.data.selectBank[i].lbnkNo + '" data-name="' + data.data.selectBank[i].lbnkNm + '" style="width:100%;margin-left:0" onclick="clickS2(this)" >' + data.data.selectBank[i].lbnkNm + '</div>'
                    }
                    document.getElementById('searchBox2').innerHTML = str

                    // layer.msg('保存成功')
                    // setTimeout(function(){
                    //  x_admin_close()
                    // },500);

                } else {
                    layer.msg(data.msg)
                    $('#searchBox1').hide()

                }
            },
            function(data) {
                console.log('222')
            }
        )

    }
    // chOne
    // chTwo
    // chThr
    layui.use(['laydate', 'table', 'upload', 'form'], function() {
        var $ = layui.jquery,
            upload = layui.upload,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form,
            admin = layui.admin,
            element = layui.element,
            layer = layui.layer;
        // var index = layer.load(2, { shade: [0.4, '#393D49'] })
        var tableSelect = layui.tableSelect;
        //开户银行
        if (acctoken == 'no') {
            layer.msg('未查询到百度API，暂时无法使用图片识别')
        }
        var hangStr = '<option value="">请搜索或选择银行</option>'
        for (var i = 0; i < hangbie.length; i++) {
            hangStr += '<option value=' + hangbie[i].value + '|' + hangbie[i].text + '>' + hangbie[i].text + '</option>'
        }
        $('#openingBank').html(hangStr)
        //查询代理商
        $("#agName").bind('input propertychange', function() {
            console.log(this.value)
            $('#agName').removeAttr('agentNumber')
            $('#agName').removeAttr('agentType')
            document.getElementById('searchBox').innerHTML = ''
            CmsUtility.postAjaxCall2(
                //系统设置
                server + 'InsMer/getInsAgent', {


                    "institutionNumber": userNumber,
                    "agentNumber": JSON.parse(sessionStorage.getItem('agentUser')).Number,
                    "agentName": $('#agName').val(),
                    "page": 1,
                    "limit": '100',
                },
                function(data) {
                    console.log(this.value)
                    if (data.code == 1000) {
                        // if(data.data == null){
                        //     layer.msg(data.msg)
                        //     return
                        //    }
                        var str = ''
                        for (var i = 0; i < data.data.agentlist.length; i++) {
                            str += '<div class="layui-btn layui-btn-primary"   data-id="' + data.data.agentlist[i].agentNumber + '" data-name="' + data.data.agentlist[i].agentName + '" style="width:100%;margin-left:0" onclick="clickS(this)" >' + '[' + data.data.agentlist[i].agentNumber + ']' + data.data.agentlist[i].agentName + '</div>'
                        }
                        document.getElementById('searchBox').innerHTML = str


                    } else {
                        layer.msg(data.msg)
                        $('#searchBox').hide()

                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        })
        $("#slName").bind('input propertychange', function() {
            console.log(this.value)
            if (!$('#agName').attr('agentnumber')) {
                layer.msg('请先选择服务商')
                return
            }
            $('#slName').removeAttr('agentNumber')

            document.getElementById('searchBox1').innerHTML = ''
            CmsUtility.postAjaxCall2(
                //系统设置
                server + 'InsMer/getAgentSale', {

                    "agentNumber": $('#agName').attr('agentnumber'),
                    "saleName": $('#slName').val(),
                    "page": 1,
                    "limit": '100',
                },
                function(data) {
                    console.log(this.value)
                    if (data.code == 1000) {
                        // if(data.data == null){
                        //     layer.msg(data.msg)
                        //     return
                        //    }
                        var str = ''
                        for (var i = 0; i < data.data.agentSale.length; i++) {
                            str += '<div class="layui-btn layui-btn-primary"  data-id="' + data.data.agentSale[i].saleNumber + '" data-name="' + data.data.agentSale[i].saleName + '" style="width:100%;margin-left:0" onclick="clickS1(this)" >' + '[' + data.data.agentSale[i].saleNumber + ']' + data.data.agentSale[i].saleName + '</div>'
                        }
                        document.getElementById('searchBox1').innerHTML = str


                    } else {
                        layer.msg(data.msg)
                        $('#searchBox1').hide()

                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        })
        //模糊查询支行
        $("#openingBankBranch").bind('input propertychange', function() {
            console.log(this.value)
            if ($('#openingBank').val() == '') {
                layer.msg('请先选择开户银行')
                return
            }
            $('#openingBankBranch').removeAttr('openingBankNumber')

            document.getElementById('searchBox2').innerHTML = ''
            CmsUtility.postAjaxCall2(
                //系统设置
                'https://nb.51shanhe.com/shanhe-common/cache/getBank', {
                    "bankCode": $('#openingBank').val().split('|')[0],
                    "paymentType": '4',
                    "bankName": $('#openingBankBranch').val(),
                    "page": 1,
                    "limit": '100',
                },
                function(data) {
                    console.log(this.value)
                    if (data.code == 1000) {

                        var str = ''
                        for (var i = 0; i < data.data.selectBank.length; i++) {
                            str += '<div class="layui-btn layui-btn-primary" data-id="' + data.data.selectBank[i].lbnkNo + '" data-name="' + data.data.selectBank[i].lbnkNm + '" style="width:100%;margin-left:0" onclick="clickS2(this)" >' + data.data.selectBank[i].lbnkNm + '</div>'
                        }
                        document.getElementById('searchBox2').innerHTML = str

                        // layer.msg('保存成功')
                        // setTimeout(function(){
                        //  x_admin_close()
                        // },500);

                    } else {
                        layer.msg(data.msg)
                        $('#searchBox1').hide()

                    }
                },
                function(data) {
                    console.log('222')
                }
            )
        })
        CmsUtility.postAjaxCall2(
            //系统设置
            'https://nb.51shanhe.com/shanhe-common/cache/getOperationIds', {
                "institutionNumber": userNumber,
                "paymentType": 4
            },
            function(data) {
                operlist = data.data
                for (var i = 0; i < operlist.length; i++) {
                    var ob1 = new Object()
                    var ob2 = new Object()

                    var ob2List = new Array()
                    ob1.name = operlist[i].supMccNm
                    ob1.id = operlist[i].supMccCd
                    ob2.parId = operlist[i].supMccCd
                    operlistOne.push(ob1)
                    for (var j = 0; j < operlist[i].list.length; j++) {
                        var ob3 = new Object()
                        var ob4 = new Object()
                        var ob4List = new Array()
                        ob3.name = operlist[i].list[j].MccTypeNm
                        ob3.id = operlist[i].list[j].MccType
                        ob4.parId = operlist[i].list[j].MccType
                        ob2List.push(ob3)
                        var operlistThrList = operlist[i].list[j].ids
                        for (var k = 0; k < operlistThrList.length; k++) {
                            var ob5 = new Object()
                            ob5.name = operlistThrList[k].MccNm
                            ob5.id = operlistThrList[k].MccCd
                            ob4List.push(ob5)
                        }
                        ob4.childList = ob4List
                        operlistThr.push(ob4)
                    }
                    ob2.childList = ob2List
                    operlistTwo.push(ob2)
                }
                var str = ''
                for (var i = 0; i < operlistOne.length; i++) {
                    str += "<option value=" + operlistOne[i].id + " >" + operlistOne[i].name + "</option>"
                }
                $('#chOne').html(str)
                var str1 = ''
                for (var j = 0; j < operlistTwo[0].childList.length; j++) {
                    str1 += "<option value=" + operlistTwo[0].childList[j].id + " >" + operlistTwo[0].childList[j].name + "</option>"
                }
                $('#chTwo').html(str1)
                var str2 = ''
                for (var j = 0; j < operlistThr[0].childList.length; j++) {
                    str2 += "<option value=" + operlistThr[0].childList[j].id + " >" + operlistThr[0].childList[j].name + "</option>"
                }
                $('#chThr').html(str2)
                form.render()
            },
            function(data) {

            },'post','true'
        )
        form.on('select(chOne)', function(data) {
            console.log(data.value)
            var str = ''
            var str1 = ''
            var childId
            for (var i = 0; i < operlistTwo.length; i++) {
                if (operlistTwo[i].parId == data.value) {
                    childId = operlistTwo[i].childList[0].id
                    for (var j = 0; j < operlistTwo[i].childList.length; j++) {

                        str += "<option value=" + operlistTwo[i].childList[j].id + " >" + operlistTwo[i].childList[j].name + "</option>"
                    }
                }
            }
            console.log(childId)
            for (var k = 0; k < operlistThr.length; k++) {
                if (operlistThr[k].parId == childId) {
                    for (var h = 0; h < operlistThr[k].childList.length; h++) {

                        str1 += "<option value=" + operlistThr[k].childList[h].id + " >" + operlistThr[k].childList[h].name + "</option>"
                    }
                }
            }
            $('#chTwo').html(str)
            $('#chThr').html(str1)
            form.render()
        })
        form.on('select(chTwo)', function(data) {
            console.log(data.value)
            var str = ''
            for (var k = 0; k < operlistThr.length; k++) {
                if (operlistThr[k].parId == data.value) {
                    for (var h = 0; h < operlistThr[k].childList.length; h++) {

                        str += "<option value=" + operlistThr[k].childList[h].id + " >" + operlistThr[k].childList[h].name + "</option>"
                    }
                }
            }
            $('#chThr').html(str)
            form.render()

        })
        CmsUtility.postAjaxCall2(
            //系统设置
            'https://nb.51shanhe.com/shanhe-common/cache/getAreajson02', {
                // "institutionNumber": userNumber,
                // "paymentType": 4
            },
            function(data) {
                citylist = data.data
                for (var i = 0; i < citylist.length; i++) {
                    var ob1 = new Object()
                    var ob2 = new Object()

                    var ob2List = new Array()
                    ob1.name = citylist[i].provName
                    ob1.id = citylist[i].provCode
                    ob2.parId = citylist[i].provCode
                    prov.push(ob1)
                    for (var j = 0; j < citylist[i].cityList.length; j++) {
                        var ob3 = new Object()
                        var ob4 = new Object()
                        var ob4List = new Array()
                        ob3.name = citylist[i].cityList[j].cityName
                        ob3.id = citylist[i].cityList[j].cityCode
                        ob4.parId = citylist[i].cityList[j].cityCode
                        ob2List.push(ob3)
                        var arealist = citylist[i].cityList[j].areaList
                        for (var k = 0; k < arealist.length; k++) {
                            var ob5 = new Object()
                            ob5.name = arealist[k].areaName
                            ob5.id = arealist[k].areaCode
                            ob4List.push(ob5)
                        }
                        ob4.childList = ob4List
                        area.push(ob4)
                    }
                    ob2.childList = ob2List
                    city.push(ob2)
                }
                var str = ''
                for (var i = 0; i < prov.length; i++) {
                    str += "<option value=" + prov[i].id + '|' + prov[i].name + " >" + prov[i].name + "</option>"
                }
                $('#prov').html(str)
                // console.log(operlistTwo)
                var str1 = ''
                for (var j = 0; j < city[0].childList.length; j++) {
                    str1 += "<option value=" + city[0].childList[j].id + '|' + city[0].childList[j].name + " >" + city[0].childList[j].name + "</option>"
                }
                $('#city').html(str1)
                var str2 = ''
                for (var j = 0; j < area[0].childList.length; j++) {
                    str2 += "<option value=" + area[0].childList[j].id + '|' + area[0].childList[j].name + " >" + area[0].childList[j].name + "</option>"
                }
                $('#area').html(str2)
                form.render()
            },
            function(data) {

            },'post','false'
        )
        form.on('select(prov)', function(data) {
            console.log(data.value)
            var str = ''
            var str1 = ''
            var childId
            for (var i = 0; i < city.length; i++) {
                if (city[i].parId == data.value.split('|')[0]) {
                    childId = city[i].childList[0].id
                    for (var j = 0; j < city[i].childList.length; j++) {

                        str += "<option value=" + city[i].childList[j].id + '|' + city[i].childList[j].name + " >" + city[i].childList[j].name + "</option>"
                    }
                }
            }
            console.log(childId)
            for (var k = 0; k < area.length; k++) {
                if (area[k].parId == childId) {
                    for (var h = 0; h < area[k].childList.length; h++) {

                        str1 += "<option value=" + area[k].childList[h].id + '|' + area[k].childList[h].name + " >" + area[k].childList[h].name + "</option>"
                    }
                }
            }
            $('#city').html(str)
            $('#area').html(str1)
            form.render()
        })
        form.on('select(city)', function(data) {
            console.log(data.value)
            var str = ''
            for (var k = 0; k < area.length; k++) {
                if (area[k].parId == data.value.split('|')[0]) {
                    for (var h = 0; h < area[k].childList.length; h++) {

                        str += "<option value=" + area[k].childList[h].id + " >" + area[k].childList[h].name + "</option>"
                    }
                }
            }
            $('#area').html(str)
            form.render()

        })
        laydate.render({
            elem: '#businessLicenseTime' //指定元素
        });
        laydate.render({
            elem: '#businessLicenseEndTime' //指定元素
        });
        laydate.render({
            elem: '#juridicalpersonIdTime' //指定元素
        });
        laydate.render({
            elem: '#juridicalPersonIDEndTime' //指定元素
        });
        form.on('radio(cardvalid)', function(data) { //设置会员卡的有效期

            if (data.value == 0) {
                $('.noGeren').hide()
                $('.geren').show()
                $('.qiye').hide()
                $('.noQiye').show()
                merType = 0
            } else if (data.value == 1) {
                $('.noGeren').show()
                $('.geren').hide()
                $('.qiye').hide()
                $('.noQiye').hide()
                merType = 1
            } else if (data.value == 2) {
                $('.noGeren').show()
                $('.geren').hide()
                $('.qiye').show()
                $('.noQiye').hide()
                merType = 2
            }
        });

        //营业执照
        var uploadInst = upload.render({
            elem: '#businessLicense',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 1
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    var result = result
                    $.ajax({
                        type: 'post',
                        url: 'https://aip.baidubce.com/rest/2.0/ocr/v1/business_license?access_token=' + acctoken,
                        data: {
                            "image": result.replace(/data:image\/.*;base64,/, '')

                        },
                        headers: {
                            'Content-Type': "application/x-www-form-urlencoded"
                        },
                        success: function(data) {
                            console.log(data)
                            form.val('cardAdd', {
                                "bankCardNo": fourStr(data.words_result.签发日期.words)
                            })

                            // $('#juridicalpersonIdTime')
                            // $('#juridicalPersonIDEndTime')




                        }
                    })
                });
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
                    var timeStr = new Date().getTime()
                    console.log(res.data + '?time='+timeStr)
                    $('#businessLicense').attr('src', res.data + '?time='+timeStr); //图片链接（base64）

                    businessLicense = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //收银台照
        var uploadInst = upload.render({
            elem: '#cashier',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 13
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#cashier').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    cashier = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //场景照
        var uploadInst = upload.render({
            elem: '#placeBusiness',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 14
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#placeBusiness').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    placeBusiness = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //门头照
        var uploadInst = upload.render({
            elem: '#doorheadPhoto',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 5
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#doorheadPhoto').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    doorheadPhoto = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //身份证正面


        var uploadInst = upload.render({
            elem: '#juridicalpersonIdPositive',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 2
            },
            before: function(obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    var result = result
                    $.ajax({
                        type: 'post',
                        url: 'https://aip.baidubce.com/rest/2.0/ocr/v1/idcard?access_token=' + acctoken,
                        data: {
                            "image": result.replace(/data:image\/.*;base64,/, ''),
                            "id_card_side": 'front',

                        },
                        headers: {
                            'Content-Type': "application/x-www-form-urlencoded"
                        },
                        success: function(data) {
                            console.log(data)
                            form.val('cardAdd', {
                                "juridicalpersonId": data.words_result.公民身份号码.words,
                                "juridicalpersonName": data.words_result.姓名.words
                            })

                            // $('#juridicalpersonIdTime')
                            // $('#juridicalPersonIDEndTime')




                        }
                    })
                });
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#juridicalpersonIdPositive').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    juridicalpersonIdPositive = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //身份证反面

        var uploadInst = upload.render({
            elem: '#juridicalpersonIdReverseside',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 3
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    var result = result
                    $.ajax({
                        type: 'post',
                        url: 'https://aip.baidubce.com/rest/2.0/ocr/v1/idcard?access_token=' + acctoken,
                        data: {
                            "image": result.replace(/data:image\/.*;base64,/, ''),
                            "id_card_side": 'back',

                        },
                        headers: {
                            'Content-Type': "application/x-www-form-urlencoded"
                        },
                        success: function(data) {
                            console.log(data)
                            form.val('cardAdd', {
                                "juridicalpersonIdTime": fourStr(data.words_result.签发日期.words),
                                "juridicalPersonIDEndTime": fourStr(data.words_result.失效日期.words)
                            })

                            // $('#juridicalpersonIdTime')
                            // $('#juridicalPersonIDEndTime')




                        }
                    })
                });
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#juridicalpersonIdReverseside').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    juridicalpersonIdReverseside = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //手持身份证

        var uploadInst = upload.render({
            elem: '#holdId',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 11
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#holdId').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    holdId = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //开户许可证

        var uploadInst = upload.render({
            elem: '#openingPermit',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 12
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#openingPermit').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    openingPermit = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //银行卡正面

        var uploadInst = upload.render({
            elem: '#bankCardPositive',
            url: server + 'InsMer/uploadMerchantImg',
            data: {
                "institutionNumber": userNumber,
                "longTime":merchantNumber,
                "type": 6
            },
            before: function(obj) {
                console.log(obj)
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result) {
                    var result = result
                    $.ajax({
                        type: 'post',
                        url: 'https://aip.baidubce.com/rest/2.0/ocr/v1/bankcard?access_token=' + acctoken,
                        data: {
                            "image": result.replace(/data:image\/.*;base64,/, '')

                        },
                        headers: {
                            'Content-Type': "application/x-www-form-urlencoded"
                        },
                        success: function(data) {
                            console.log(data)
                            form.val('cardAdd', {
                                "bankCardNo": fourStr(data.words_result.签发日期.words)
                            })

                            // $('#juridicalpersonIdTime')
                            // $('#juridicalPersonIDEndTime')




                        }
                    })
                });
                var index = layer.load(2, { shade: [0.4, '#393D49'] })
            },
            done: function(res) {
                layer.closeAll()
                //如果上传失败
                if (res.code != 1000) {

                    return layer.msg('上传失败');

                } else {
var timeStr = new Date().getTime()
                    $('#bankCardPositive').attr('src', res.data+ '?time='+timeStr); //图片链接（base64）

                    bankCardPositive = res.data
                    return layer.msg('上传成功');

                }
                //上传成功
                console.log(res)
            },
            error: function() {

            }
        });
        //通道
        CmsUtility.postAjaxCall2(
            //系统设置
            server + 'InsMer/getInstitutionPayments', {
                "institutionNumber": userNumber,
            },
            function(data) {
                 payList = data.data
                var str = ''
                // for (var k = 0; k < payList.length; k++) {

                //     if (payList[k].paymentType == 4 || payList[k].paymentType == 5) {
                //         str += '<input type="checkbox"   data-type=' + payList[k].paymentType + ' name="payment" value=' + payList[k].paymentChannel + '|' + payList[k].paymentType + ' title=' + payList[k].paymentChannelName + ' checked="">'
                //     } else {
                //         str += '<input type="checkbox"   data-type=' + payList[k].paymentType + ' name="payment" value=' + payList[k].paymentChannel + '|' + payList[k].paymentType + ' title=' + payList[k].paymentChannelName + '>'
                //     }


                // }
                // $('#paymentBox').html(str)
                // form.render()
            },
            function(data) {

            },
            'get','false'
        )

        form.on('switch(isOpenYunPay)', function(data) {
            if (this.checked == true) {

                isOpenYunPay = 0
            } else {
                isOpenYunPay = 1
            }

        });
        form.on('switch(businessLicenseType)', function(data) {
            if (this.checked == true) {
                $('.yyNoChangqi').hide()
                businessLicenseType = 0
            } else {
                $('.yyNoChangqi').show()
                businessLicenseType = 1
            }

        });
        form.on('switch(juridicalPersonIDType)', function(data) {
            if (this.checked == true) {
                $('.sfzNoChangqi').hide()
                juridicalPersonIDType = 0
            } else {
                $('.sfzNoChangqi').show()
                juridicalPersonIDType = 1
            }

        });
        //验证
        form.verify({
            title: function(value) {
                if (!value) {
                    return '必填项不能为空！';
                }
            },
            title1: function(value) {
                if (merType != 0) {
                    if (!value) {
                        return '必填项不能为空！';
                    }
                }
            },
            title2: function(value) {
                if (merType != 0 && businessLicenseType == 1) {
                    if (!value) {
                        return '必填项不能为空！';
                    }
                }
            },
            title3: function(value) {
                if (juridicalPersonIDType == 1) {
                    if (!value) {
                        return '必填项不能为空！';
                    }
                }
            },
        });
        var index = layer.load(2, {shade: [0.4, '#393D49']})
        setTimeout(function(){
            CmsUtility.postAjaxCall2(
            //系统设置
            server + '/InsMer/getMerchantInfo', {
                "merchantNumber": merchantNumber,
                "institutionNumber":JSON.parse(sessionStorage.getItem('agentUser')).institutionNumber
            },
            function(data) {
                console.log(data)
                if (data.code == 1000) {
                    merInfo = data.data.merchant
                    paymentInfo = data.data.merchantPayments
                    businessLicense = merInfo.businessLicense
                    cashier = merInfo.cashier
                    placeBusiness = merInfo.placeBusiness
                    doorheadPhoto = merInfo.doorheadPhoto
                    juridicalpersonIdPositive = merInfo.juridicalpersonIdPositive
                    juridicalpersonIdReverseside = merInfo.juridicalpersonIdReverseside
                    holdId = merInfo.holdId
                    openingPermit = merInfo.openingPermit
                    bankCardPositive = merInfo.bankCardPositive
                    $('#businessLicense').attr('src', businessLicense)
                    $('#cashier').attr('src', cashier)
                    $('#placeBusiness').attr('src', placeBusiness)
                    $('#doorheadPhoto').attr('src', doorheadPhoto)
                    $('#juridicalpersonIdPositive').attr('src', juridicalpersonIdPositive)
                    $('#juridicalpersonIdReverseside').attr('src', juridicalpersonIdReverseside)
                    $('#holdId').attr('src', holdId)
                    $('#openingPermit').attr('src', openingPermit)
                    $('#bankCardPositive').attr('src', bankCardPositive)
                    merInfo.merchantType1 = merInfo.merchantType
                    if (merInfo.merchantType == '个人') {
                        merInfo.merchantTyp1 = '0'
                        $('.noGeren').hide()
                        $('.geren').show()
                        $('.qiye').hide()
                        $('.noQiye').show()
                        merType = 0
                    }
                    if (merInfo.merchantType == '个体') {
                        merInfo.merchantTyp1 = '1'
                        $('.noGeren').show()
                        $('.geren').hide()
                        $('.qiye').hide()
                        $('.noQiye').hide()
                        merType = 1
                    }
                    if (merInfo.merchantType == '企业') {
                        merInfo.merchantTyp1 = '2'
                        $('.noGeren').show()
                        $('.geren').hide()
                        $('.qiye').show()
                        $('.noQiye').hide()
                        merType = 2
                    }

                    if (merInfo.isOpenYunPay == true) {

                        isOpenYunPay = 0
                    } else {
                        isOpenYunPay = 1
                    }
                    if (merInfo.businessLicenseType == 0) {
                        $('.yyNoChangqi').hide()
                        businessLicenseType = 0
                    } else {
                        $('.yyNoChangqi').show()
                        businessLicenseType = 1
                    }
                    if (merInfo.juridicalPersonIDType == 0) {
                        $('.sfzNoChangqi').hide()
                        juridicalPersonIDType = 0
                    } else {
                        $('.sfzNoChangqi').show()
                        juridicalPersonIDType = 1
                    }
                    var str,str1
                    for (var i = 0; i < operlistTwo.length; i++) {
                        if (operlistTwo[i].parId == merInfo.oneOperate) {
                           
                            for (var j = 0; j < operlistTwo[i].childList.length; j++) {

                                str += "<option value=" + operlistTwo[i].childList[j].id + " >" + operlistTwo[i].childList[j].name + "</option>"
                            }
                        }
                    }
                    for (var k = 0; k < operlistThr.length; k++) {
                        if (operlistThr[k].parId == merInfo.twoOperate) {
                            for (var h = 0; h < operlistThr[k].childList.length; h++) {

                                str1 += "<option value=" + operlistThr[k].childList[h].id + " >" + operlistThr[k].childList[h].name + "</option>"
                            }
                        }
                    }
                    $('#chTwo').html(str)
                    $('#chThr').html(str1)
                    var strr = ''
                    for (var i = 0; i < prov.length; i++) {
                        if(prov[i].id == merInfo.provinceID ){
                            strr += "<option value=" + prov[i].id + '|' + prov[i].name + " selected >" + prov[i].name + "</option>"
                            
                        }else{
                            strr += "<option value=" + prov[i].id + '|' + prov[i].name + " >" + prov[i].name + "</option>"
                        }
                        
                    }
                    $('#prov').html(strr)
                    var strr1 = ''
                    for (var j = 0; j < city.length; j++) {
                        if(city[j].parId == merInfo.provinceID){
                            for( var k = 0 ; k < city[j].childList.length;k++){
                                 if(city[j].childList[k].id == merInfo.cityID){
                                     strr1 += "<option value=" + city[j].childList[k].id + '|' + city[j].childList[k].name + " selected >" + city[j].childList[k].name + "</option>"
                                 }else{
                                    strr1 += "<option value=" + city[j].childList[k].id + '|' + city[j].childList[k].name + " >" + city[j].childList[k].name + "</option>"
                                 }
                            }
                        }
                       
                       
                    }
                    $('#city').html(strr1)
                    var strr2 = ''
                    for (var j = 0; j < area.length; j++) {
                        if(area[j].parId == merInfo.cityID){
                            for(var k = 0 ; k < area[j].childList.length;k++){
                                if(area[j].id == merInfo.areaID){
                                    strr2 += "<option value=" + area[j].childList[k].id + '|' + area[j].childList[k].name + " selected>" + area[j].childList[k].name + "</option>"
                                }else{
                                    strr2 += "<option value=" + area[j].childList[k].id + '|' + area[j].childList[k].name + " >" + area[j].childList[k].name + "</option>"
                                }
                            }
                        }
                        
                    }
                    $('#area').html(strr2)
                    $('#agName').val(merInfo.agentName)
                    $('#agName').attr('agentNumber', merInfo.agentNumber)
                    $('#slName').val(merInfo.saleName)
                    $('#slName').attr('saleNumber', merInfo.saleNumber)
                    console.log(payList)
                    var pStr = ''
                    // for(var b = 0 ; b < payList.length;b++){
                    //     var type = 0
                    //     for(var v = 0 ; v < paymentInfo.length;v++){
                    //         if(paymentInfo[v].paymentChannel == payList[b].paymentChannel){
                    //             type = 1
                    //         }
                    //     }
                    //     if(type == 0){
                    //         pStr += '<input type="checkbox"   data-type=' + payList[b].paymentType + ' name="payment" value=' + payList[b].paymentChannel + '|' + payList[b].paymentType + ' title=' + payList[b].paymentChannelName + ' >'
                    //     }else{
                    //         pStr += '<input type="checkbox"   data-type=' + payList[b].paymentType + ' name="payment" value=' + payList[b].paymentChannel + '|' + payList[b].paymentType + ' title=' + payList[b].paymentChannelName + ' checked="">'
                    //     }
                    // }
                    // $('#paymentBox').html(pStr)
                    // form.render()
                    form.render()
                    form.val('cardAdd', {
                        "merchantType": merInfo.merchantTyp1,
                        "merchantAbbreviation": merInfo.merchantAbbreviation,
                        "merchantName": merInfo.merchantName,
                        "businessLicenseName":merInfo.businessLicenseName,
                        "oneOperate": merInfo.oneOperate,
                        "twoOperate": merInfo.twoOperate,
                        "threeOperate": merInfo.threeOperate,
                        "customerServiceTell": merInfo.customerServiceTell,
                        "rate": merInfo.rate,
                        "businessLicenseNo": merInfo.businessLicenseNo,
                        "businessLicenseTime": merInfo.businessLicenseTime,
                        "businessLicenseEndTime": merInfo.businessLicenseEndTime,
                        "businessLicenseType": merInfo.businessLicenseType == 0?true:false,
                        "mailbox": merInfo.mailbox,
                        "isOpenYunPay": merInfo.isOpenYunPay == 0?true:false,
                        
                        "address": merInfo.address,
                        "weChatNo": merInfo.weChatNo,
                        "aliPayNo": merInfo.aliPayNo,
                        "juridicalpersonId": merInfo.juridicalpersonId,
                        "juridicalpersonName": merInfo.juridicalpersonName,
                        "registerCell": merInfo.registerCell,
                        "juridicalpersonIdTime": merInfo.juridicalpersonIdTime,
                        "juridicalPersonIDEndTime": merInfo.juridicalPersonIDEndTime,
                        "juridicalPersonIDType": merInfo.juridicalPersonIDType == 0?true:false,

                        "bankCardNo": merInfo.bankCardNo,
                        "openingBank1": merInfo.openingBankID + '|' +merInfo.openingBank,
                        "openingBankBranch": merInfo.openingBankBranch,
                        "openingBankBranchAddress": merInfo.openingBankBranchAddress,
                        "reserveCell": merInfo.reserveCell,          


                    })
                    layer.closeAll()
                } else {

                    layer.msg(data.msg)
                }
            },
            function(data) {

            }
        )
        },500)
        
        form.on('submit(add)', function(data, index) {
            console.log(data)
            if (cashier == '' || placeBusiness == '' || doorheadPhoto == '' || juridicalpersonIdPositive == '' || juridicalpersonIdReverseside == '' || holdId == '' || bankCardPositive == '') {
                layer.msg('请补充图片信息')
                return false
            }
            if (merType != 0) {
                if (businessLicense == '') {
                    layer.msg('请补充图片信息')
                    return false
                }
            }
            if (merType == 2) {
                if (openingPermit == '') {
                    layer.msg('请补充图片信息')
                    return false
                }
            }
            // var arr = new Array();
            // $("input:checkbox[name='payment']:checked").each(function(i) {
            //     arr[i] = $(this).val();
            // });
            // console.log(arr)
            // var pyList = []
            // for (var j = 0; j < arr.length; j++) {
            //     var pb = new Object()
            //     pb.paymentType = arr[j].split('|')[1]
            //     pb.paymentChannel = arr[j].split('|')[0]
            //     pyList.push(pb)
            // }
           
            var tjData = data.field
            tjData.institutionNumber = userNumber
            tjData.agentNumber = $('#agName').attr('agentnumber')
            tjData.saleNumber = $('#slName').attr('salenumber')

            tjData.businessLicense = isWen(businessLicense)
            tjData.cashier = isWen(cashier)
            tjData.placeBusiness = isWen(placeBusiness)
            tjData.doorheadPhoto = isWen(doorheadPhoto)
            tjData.facePhoto = isWen(doorheadPhoto)
            tjData.juridicalpersonIdPositive = isWen(juridicalpersonIdPositive)
            tjData.juridicalpersonIdReverseside = isWen(juridicalpersonIdReverseside)
            tjData.holdId = isWen(holdId)
            tjData.openingPermit = isWen(openingPermit)
            tjData.bankCardPositive = isWen(bankCardPositive)
            tjData.longTime = longTime
            if (tjData.merchantType == '0') {
                tjData.merchantType = '个人'
                tjData.acntType = '对私'
            }
            if (tjData.merchantType =='1') {
                tjData.merchantType = '个体'
                tjData.acntType = '对私'
            }
            if (tjData.merchantType == '2') {
                tjData.merchantType = '企业'
                tjData.acntType = '对公'
            }
            tjData.paymentType= channelType
            tjData.paymentChannel = channel
            tjData.juridicalPersonIDType = juridicalPersonIDType
            tjData.businessLicenseName = tjData.merchantName
            tjData.businessLicenseType = businessLicenseType
            tjData.operationId = data.field.threeOperate
            tjData.province = tjData.prov1.split('|')[1]
            tjData.provinceID = tjData.prov1.split('|')[0]
            tjData.city = tjData.city1.split('|')[1]
            tjData.cityID = tjData.city1.split('|')[0]
            tjData.area = tjData.area1.split('|')[1]
            tjData.areaID = tjData.area1.split('|')[0]
            tjData.businessLicenseAddress = tjData.province + tjData.city + tjData.area + tjData.address
            console.log(tjData)
            tjData.isOpenYunPay = isOpenYunPay
            // tjData.paymentChannels = JSON.stringify(pyList)
            tjData.subsidy = 1
            tjData.openingBank = tjData.openingBank1.split('|')[1]
            tjData.openingBankID = tjData.openingBank1.split('|')[0]
            tjData.openingBankBranch = $('#openingBankBranch').attr('openingBankName')
            tjData.openingBankBranchID = $('#openingBankBranch').attr('openingBankNumber')
            tjData.merchantNumber = merchantNumber
            var index = layer.load(2, { shade: [0.4, '#393D49'] })
            CmsUtility.postAjaxCall2(
                //系统设置
                server + 'InsMer/addMerchantOrderInfo',
                tjData,
                function(data) {
                    console.log(data)
                    layer.closeAll()
                    if (data.code == 1000) {
                        setTimeout(function(){
                            x_admin_close()
                            parent.layer.msg('服务成功')
                            window.parent.location.reload()
                        })
                    } else {
                        layer.msg(data.msg)
                    }
                },
                function(data) {

                }
            )
            return false;
        });
    })
    </script>
</body>

</html>