<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="../../public/css/font.css">
    <link rel="stylesheet" href="../../public/css/xadmin.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../public/js/xadmin.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
    .layui-btn+.layui-btn {
        margin-left: -2px;
    }

    .layui-table-cell {
        height: auto;
        overflow: inherit;
    }

    .layui-form-select dl {
        text-align: left;
    }

    .operationList th:nth-child(1) {
        width: 50px;
    }

    .operationList td:nth-child(1) {
        text-align: center;
    }

    .operation_select .layui-form-select {
        width: 90%;
    }

    .operation_table .layui-table {
        width: 90%;
        border: 1px solid #e6e6e6;
        border-width: 1px !important;
    }

    .operation_table .layui-table tr th:last-child {
        text-align: center;
    }

    .operation_table .layui-table tr td:nth-child(1) {
        text-align: center;
    }

    .operation_table .layui-table tr td:nth-child(4) {
        text-align: center;
        padding-left: 10px;
        padding-right: 10px;
        box-sizing: border-box;
    }
    </style>
</head>

<body id="iosiframe">
    <div class="x-body">
        <div class="layui-form">
            <table class="layui-hide" id="members" lay-filter="members"></table>
            <div class="layui-form-item layui-layout-admin">
                <div class="layui-input-block">
                    <div class="layui-footer" style="left: 0;text-align: center;">
                        <button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
                        <button class="layui-btn layui-btn-primary">取消</button>
                    </div>
                    <!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
                </div>
            </div>
        </div>
    </div>
    <script type="text/html" id="switchBar">
        <input type="checkbox" name="consumptionPreferences" lay-skin="switch" lay-filter="consumptionPreferences" lay-text="开|关">
		</script>
    <script type="text/html" id="toolbar">
        <div class="layui-input-inline" style="width: 100px;margin-bottom: 10px;">
				<input type="radio" name="operation{{d.id}}" data_pid="{{d.id}}" value="1" title="单独" lay-filter="operation" checked="">
			</div>
			<div class="layui-input-inline" style="width: 100px;margin-bottom: 10px;">
				<input type="radio" name="operation{{d.id}}" data_pid="{{d.id}}" value="2" title="轮询" lay-filter="operation">
			</div>
			<div class="layui-input-block operation_select" id="operation_select{{d.id}}" style="margin-left: 0;">
				<select name="quiz{{d.id}}">
					<option value="">请选择县/区</option>
					<option value="西湖区">西湖区</option>
					<option value="余杭区">余杭区</option>
					<option value="拱墅区">临安市</option>
				</select>
			</div>
			<div class="layui-input-block operation_table" id="operation_table{{d.id}}" style="margin-left: 0;display: none;">
				<table class="layui-table" lay-skin="line" id="" style="">
					<thead>
						<tr>
							<th></th>
							<th>通道代码</th>
							<th>通道名称</th>
							<th>权重(1-9)</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>
								<input type="checkbox" name="" lay-skin="primary">
							</td>
							<td>209</td>
							<td>乐支付网银</td>
							<td><input type="number" min="0" max="9" name="" class="layui-input"></td>
						</tr>
						<tr>
							<td>
								<input type="checkbox" name="" lay-skin="primary">
							</td>
							<td>211</td>
							<td>银联网关支付</td>
							<td><input type="number" min="0" max="9" name="" class="layui-input"></td>
						</tr>
						<tr>
							<td>
								<input type="checkbox" name="" lay-skin="primary">
							</td>
							<td>213</td>
							<td>汇通网关支付</td>
							<td><input type="number" min="0" max="9" name="" class="layui-input"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</script>
    <script>
    //			var arr = ['7','3','5']
    //			arr.sort(paixu(a))
    //			function paixu(a){
    //				return function(a,b){
    //					var a = a[a]
    //					var b = b[a]
    //					return b-a
    //				}
    //			}
    //			var str = ''
    //			for(var i = 0 ; i < arr.length ; i++){
    //				str += '<tr><td><input type="checkbox" name="" lay-skin="primary"></td><td>'+ arr[i] +'</td><td>'+ arr[i] +'</td><td><input type="number" min="0" max="9" name="" class="layui-input" value="'+ arr[i] +'"></td></tr>'
    //			}
    //			console.log(str)
    //			console.log(arr)
    var serverUrl = window.parent.serverUrl
    var userNumber = window.parent.userNumber
    layui.use(['laytpl', 'laydate', 'table', 'form'], function() {
        var laytpl = layui.laytpl,
            laydate = layui.laydate,
            table = layui.table,
            form = layui.form;

        //方法级渲染  
        table.render({
            //url: serverUrl + 'memberCard/getAssociatorCards?userNumber=' + userNumber,
            url: '../../public/json/dome1.json',
            elem: '#members',
            id: 'vip_cardList',
            //parseData: function(res) { //res 即为原始返回的数据
            //	return {
            //		"code": res.code, //解析接口状态
            //		"msg": res.msg, //解析提示文本
            //		"count": res.count, //解析数据长度
            //		"data": changeRes(res.result,res.count), //解析数据列表
            //	};
            //},
            cols: [
                [{
                    align: 'center',
                    field: 'id',
                    title: '支付产品',
                    sort: true,
                    width: 200
                }, {
                    align: 'center',
                    toolbar: '#switchBar',
                    title: '接口状态',
                    width: 200
                }, {
                    align: 'center',
                    title: '支付通道',
                    toolbar: '#toolbar',
                    event: 'setToolbar',
                    minWidth: 550
                }]
            ],
            page: false,
            done: function(res, curr, count) {}
        });

        /*---------- 监听开关 ----------*/
        form.on('radio(operation)', function(obj) { //
            var did = this.name.split("operation")[1]
            console.log(did)
            if (this.value == 1) {
                $(eval('operation_select' + did)).show()
                $(eval('operation_table' + did)).hide()
                table.render();
            } else if (this.value == 2) {
                $(eval('operation_select' + did)).hide()
                $(eval('operation_table' + did)).show()
                form.render();
            }
        });

        //监听工具条
        table.on('tool(members)', function(obj) {
            var data = obj.data;
            if (obj.event === 'setToolbar') { //监听单元格

            } else if (obj.event === 'edit') { //编辑
                layer.open({
                    type: 2,
                    title: '编辑',
                    shade: 0.5,
                    area: ['400px', '300px'],
                    maxmin: false,
                    resize: false,
                    content: ['Membersadd.html'],
                    success: function(layero, index) {
                        // 获取子页面的iframe
                        var iframe = window['layui-layer-iframe' + index];
                        // 向子页面的全局函数child传参
                        iframe.subPage(data, userNumber)
                    }
                });
            } else if (obj.event === 'logout') { //注销
                var zhuxiaoData = {
                    card: data.card,
                    cardType: 5
                }
                layer.confirm('真的删除此会员卡么', {
                    icon: 3,
                    title: '提示'
                }, function(index) {
                    // 发送请求
                    $.ajax({
                        type: "post",
                        url: serverUrl + "memberCard/updateAssociatorCard",
                        async: true,
                        dataType: "json",
                        contentType: "application/json",
                        data: JSON.stringify(zhuxiaoData),
                        success: function(data) {
                            if (data.code == 0) {
                                layer.close(index);
                                layer.msg("会员卡已注销");
                                // 刷新页面
                                var curr = $("#curr").val();
                                layui.table.reload('vip_cardList', {
                                    page: {
                                        curr: curr
                                    }
                                });
                            } else if (data.code == 1) {
                                layer.msg("会员卡注销失败");
                            }
                        }
                    });
                });
            }
        });
    });
    </script>
</body>

</html>