<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
		<link rel="stylesheet" href="../../public/css/font.css">
		<link rel="stylesheet" href="../../public/css/xadmin.css">
		<script type="text/javascript" src="../../public/js/jquery-3.2.1.js"></script>
		<script type="text/javascript" src="../../public/js/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../../public/lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../public/js/xadmin.js"></script>
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
		<style type="text/css">
			.set {
				width: 110px;
				margin-right: 10px;
			}

			.layui-upload-img {
				width: 150px;
				height: 150px;
				border: 1px solid #e6e6e6;
				border-radius: 2px;
				display: flex;
				justify-content: center;
				align-items: center;
			}

			#demoText {
				width: 150px;
				height: auto;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			#demoText span {
				margin-top: 10px;
			}

			#demoText a {
				margin-top: 10px;
			}

			.layui-tab-title li:first-child {
				width: 100px;
			}

			.layui-tab-title li {
				width: 100px;
			}

			.del {
				/* position: absolute;
				right: 0;
				top: 0; */
				width: 30px;
				height: 28px;
				line-height: 26px;
				margin-right: 10px;
				top: 1px;
				text-align: center;
				color: #c2c2c2;
				font-size: 20px;
				text-align: center;
				vertical-align: middle;
				display: inline-block;
				border: 1px solid #d2d2d2;
				margin-top: 3px;
				margin-left: -5px;
				text-indent: 2px;
				cursor: pointer;
			}

			.del:hover {
				background-color: #ff5722;
			}

			.layui-form-checkbox {
				margin-right: 0;
			}

			.layui-elem-quote {
				font-size: 18px;
			}

			.layui-elem-quote .layui-form-switch {
				width: 40px;
				margin: 0 15px;
				margin-top: 0;
			}

			.tips_red {
				color: red;
			}

			.tagsBody {
				max-width: 800px;
				border: 1px solid #e6e6e6;
				padding: 10px;
			}

			.tagsBody .layui-form-item:last-child {
				margin: 0;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.site-demo-active {
				width: 100px;
			}

			.newTagsInput {
				width: calc(100% - 100px);
				margin-right: 10px;
			}
			#timing .layui-form-label{width: auto;}
		</style>
	</head>

	<body id="iosiframe">
		<div class="x-nav">
			<span class="layui-breadcrumb">
				<a href="">首页</a>
				<a href="">会员</a>
				<a><cite>会员配置</cite></a>
			</span>
			<a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);"
			 title="刷新">
				<i class="layui-icon layui-icon-refresh" style="line-height:30px"></i></a>
		</div>
		<div class="x-body">
			<div class="layui-row">
				<div class="layui-form" lay-filter="basic">
					<div class="layui-form-item">
						<blockquote class="layui-elem-quote">会员开卡设置</blockquote>
						<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							<legend style="font-weight: 500;">开卡设置</legend>
						</fieldset>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<input type="checkbox" class="set" name="name" title="会员名称">
								<input type="checkbox" class="set" name="tel" title="手机号">
								<input type="checkbox" class="set" name="shengri" title="生日">
								<input type="checkbox" class="set" name="mail" title="邮箱">
								<input type="checkbox" class="set" name="address" title="地址">
								<input type="checkbox" class="set" name="chengwei" title="称谓">
								<input type="checkbox" class="set" name="team" title="分组">
								<input type="checkbox" class="set" name="tap" title="标签">
								<input type="checkbox" class="set" name="header" title="头像">
								<input type="checkbox" class="set" name="mark" title="备注信息">
							</div>
						</div>
						<!-- <blockquote class="layui-elem-quote">消费积分规则</blockquote> -->
						<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							<legend style="font-weight: 500;">消费积分规则</legend>
						</fieldset>
						<div class="layui-form-item">
							<div class="layui-block place">
								<label class="layui-form-label"></label>
								<span style="color:red">备注:积分按照整数计算，不支持小数点积分计算</span>
							</div>
							<div class="layui-block place">
								<label class="layui-form-label"></label>
								<span style="color:red">场景举例：如设置消费积分10元1分，则消费15元积1分，消费5元不积分。
								</span>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label"></label>
								<div class="layui-input-inline" style="width:120px">
									<input type="number" name="institutionRoute" class="layui-input" lay-verify="zonghoutai" id="zonghoutai">
								</div>
								<label class="layui-form-label" style="width:50px;text-align:center;">元</label>
								<label class="layui-form-label" style="width:50px;text-align:center;font-weight: bold">:</label>
							</div>
							<div class="layui-inline">
								<div class="layui-input-inline" style="width:120px">
									<input type="number" name="agentRoute" class="layui-input" lay-verify="dailishang" id="dailishang">
								</div>
								<label class="layui-form-label" style="width:50px;text-align:center;">积分</label>
							</div>
						</div>
						<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							<legend style="font-weight: 500;">会员级别和折扣设置</legend>
						</fieldset>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<input type="radio" name="sex" value="0" title="开启" checked="">
								<input type="radio" name="sex" value="1" title="关闭">
							</div>
						</div>
						<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							<legend style="font-weight: 500;">等级晋升规则 </legend>
						</fieldset>
						<div class="layui-form-item">
							<div class="layui-input-block">
								<input type="radio" name="levelup" value="0" title="按累计积分晋升等级" checked="">
								<input type="radio" name="levelup" value="1" title="按当前积分晋升等级">
							</div>
						</div>
						<blockquote class="layui-elem-quote">
							会员分组设置
							<span class="tips_red">将具有相同特征的会员放在一个分组，您可以更有针对性地营销。列如：5月1日发过短信、有欠款、可总换积分 </span>
						</blockquote>
						<div class="layui-form-item">
							<div class="layui-input-block tagsBody">
								<div class="layui-form-item" id="teamList"></div>
								<div class="layui-form-item">
									<input class="layui-input newTagsInput" type="" name="" id="newfenzuVal" value="" />
									<button class="layui-btn site-demo-active" id="newfenzu">新增分组</button>
								</div>
							</div>
						</div>
						<blockquote class="layui-elem-quote">
							会员称谓设置
							<span class="tips_red">无论是招呼客户，还是在营销短信，恰如其分的称呼，将为您的服务加分不少。例如：先生、女士、小朋友、美女等 </span>
						</blockquote>
						<div class="layui-form-item">
							<div class="layui-input-block tagsBody">
								<div class="layui-form-item" id="chengweiList"></div>
								<div class="layui-form-item">
									<input class="layui-input newTagsInput" type="" name="" id="newchengweiVal" value="" />
									<button class="layui-btn site-demo-active" id="newchengwei">新增称谓</button>
								</div>
							</div>
						</div>
						<blockquote class="layui-elem-quote">
							会员标签设置
							<span class="tips_red">帮您迅速锁定顾客喜好，投其所好地推荐商品，提高成交的可能性。例如：土豪、大方、注重质量、爱还价、苛刻等 </span>
						</blockquote>
						<div class="layui-form-item">
							<div class="layui-input-block tagsBody">
								<div class="layui-form-item" id="tagList"></div>
								<div class="layui-form-item">
									<input class="layui-input newTagsInput" type="" name="" id="newtagVal" value="" />
									<button class="layui-btn site-demo-active" id="newtag">新增标签</button>
								</div>
							</div>
						</div>
						<blockquote class="layui-elem-quote">
							会员共享
							<input type="checkbox" name="timePreferences" lay-skin="switch" lay-filter="timePreferences" lay-text="开|关">
							<span class="tips_red">设置会员的跨店消费，跨店消费</span>
						</blockquote>
						<div id="timing" class="layui-input-block">
							<div class="layui-form-item">
								<label class="layui-form-label">跨店编辑</label>
								<div class="layui-input-inline">
									<input type="radio" name="kuadian" value="0" title="开启" checked="">
									<input type="radio" name="kuadian" value="1" title="关闭">
								</div>
								<div class="layui-form-mid layui-word-aux">包含跨店消费</div>
							</div>
							<div class="layui-form-item">
								<label class="layui-form-label">跨店消费</label>
								<div class="layui-input-inline">
									<input type="radio" name="kuadian1" value="0" title="开启" checked="">
									<input type="radio" name="kuadian1" value="1" title="关闭">
								</div>
								<div class="layui-form-mid layui-word-aux">只含跨店消费</div>
							</div>
						</div>
						<div class="layui-form-item">
							<div class="layui-form-item layui-layout-admin">
								<div class="layui-input-block">
									<div class="layui-footer" style="left: 0;text-align: center;">
										<button class="layui-btn" lay-submit="" lay-filter="add">立即提交</button>
										<button type="reset" class="layui-btn layui-btn-primary" onclick="location.reload()">重置</button>
									</div>
									<!--<i class="layui-icon" lay-tips="推荐追求开发效率和缺乏前端开发经验的使用，后端开发者的最爱。">123123123</i>-->
								</div>
							</div>
						</div>
					</div>
				</div>
				<script src="../../common/config-sh.js"></script>
				<script src="../../common/utility.js"></script>
				<script>
					var serverUrl = 'http://192.168.1.190:5002/'
					// var userNumber = JSON.parse(sessionStorage.getItem('organUser')).institutionNumber;

					var code1;
					var jgData;
					var merchantca = false;
					var type;
					var logoUrl = '';

					layui.use(['laydate', 'table', 'form', 'laytpl', 'upload'], function() {
						layui.$.support.cors = true; //允许ajax跨域
						var $ = layui.jquery,
							upload = layui.upload,
							laydate = layui.laydate,
							table = layui.table,
							form = layui.form,
							laytpl = layui.laytpl;


						var $b1 = $('#newfenzu'),
							$i1 = $('#newfenzuVal'),
							$b2 = $('#newchengwei'),
							$i2 = $('#newchengweiVal'),
							$b3 = $('#newtag'),
							$i3 = $('#newtagVal');
						$i1.keyup(function(e) {
							if (e.keyCode == 13) {
								$b1.click();
							}
						});
						$i2.keyup(function(e) {
							if (e.keyCode == 13) {
								$b2.click();
							}
						});
						$i3.keyup(function(e) {
							if (e.keyCode == 13) {
								$b3.click();
							}
						});
						//会员分组设置
						var teamList = ['分组一', '分组二', '分组三']

						function getTeam() {
							var strT = ''
							for (let i = 0; i < teamList.length; i++) {
								strT += '<input type="checkbox" class="set" name="name" title="' + teamList[i] +
									'" checked=""><span class="del fenzu" data-id="' + i + '" onclick="delfenzu(' + i +
									')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
							}
							$('#teamList').html(strT)
							form.render()
						}
						getTeam()
						$('#newfenzu').click(function() {
							var newfenzuVal = $i1.val()
							if (teamList.indexOf(newfenzuVal) >= 0) {
								layer.msg('分组名重复，请重新输入')
								return
							}
							$i1.val("")
							teamList.push(newfenzuVal)
							console.log(teamList)
							getTeam()
						})
						//会员称谓设置
						var chengweiList = ['称谓一', '称谓二', '称谓三']

						function getChengwei() {
							var strT = ''
							for (let ii = 0; ii < chengweiList.length; ii++) {
								strT += '<input type="checkbox" class="set" name="name" title="' + chengweiList[ii] +
									'" checked=""><span class="del chengwei" data-id="' + ii + '" onclick="delchengwei(' + ii +
									')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
							}
							$('#chengweiList').html(strT)
							form.render()
						}
						getChengwei()
						$('#newchengwei').click(function() {
							var newchengweiVal = $i2.val()
							if (teamList.indexOf(newchengweiVal) >= 0) {
								layer.msg('分组名重复，请重新输入')
								return
							}
							$i2.val("")
							chengweiList.push(newchengweiVal)
							console.log(teamList)
							getChengwei()
						})
						//会员标签设置
						var tagList1 = ['标签一', '标签二', '标签三']

						function tagList() {
							var strT = ''
							for (let iii = 0; iii < tagList1.length; iii++) {
								strT += '<input type="checkbox" class="set" name="name" title="' + tagList1[iii] +
									'" checked=""><span class="del tag" data-id="' + iii + '" onclick="deltag(' + iii +
									')"><i class="layui-icon layui-tab-close">ဆ</i></span>'
							}
							$('#tagList').html(strT)
							form.render()
						}
						tagList()
						$('#newtag').click(function() {
							var newtagVal = $i3.val()
							if (teamList.indexOf(newtagVal) >= 0) {
								layer.msg('分组名重复，请重新输入')
								return
							}
							$i3.val("")
							tagList1.push(newtagVal)
							console.log(teamList)
							tagList()
						})
						window.delfenzu = function(num) {
							teamList.splice(num, 1)
							getTeam()
						}
						window.delchengwei = function(num) {
							chengweiList.splice(num, 1)
							getChengwei()
						}
						window.deltag = function(num) {
							tagList1.splice(num, 1)
							tagList()
						}

						/*---------- 监听开关 ----------*/
						form.on('switch(timePreferences)', function(data) { //计时开关
							if (data.elem.checked == true) {
								$('#timing').show()
								data.elem.value = "0"
								console.log(data.elem.value)
							} else if (data.elem.checked == false) {
								data.elem.value = "1"
								console.log(data.elem.value)
								$('#timing').hide()
							}
						});
						//表单初始赋值
						form.val('basic', {
							"timePreferences": true
						})
						//监听提交
						form.on('submit(add)', function(data) {
							console.log(data)
							var arr = new Array();
							$("input:checkbox[name='D0rate']:checked").each(function(i) {
								arr[i] = $(this).val();
							});
							D0List = arr.join('|')
							CmsUtility.postAjaxCall(
								//系统设置
								'InstitutionOfficial/updateTDList', {
									"institutionNumber": userNumber,
									"tDType": 'D0',
									"paymentChannelList": D0List
								},
								function(data) {

								},
								function(data) {
									console.log('222')
								}
							)
							var arr1 = new Array();
							$("input:checkbox[name='D1rate']:checked").each(function(i) {
								arr1[i] = $(this).val();
							});
							D1List = arr1.join('|')
							CmsUtility.postAjaxCall(
								//系统设置
								'InstitutionOfficial/updateTDList', {
									"institutionNumber": userNumber,
									"tDType": 'D1',
									"paymentChannelList": D1List
								},
								function(data) {

								},
								function(data) {
									console.log('222')
								}
							)
							var data = data.field;
							if (merchantca == true) {
								data.merchantCa = 0
							} else {
								data.merchantCa = 1
							}
							console.log(data)
							if (logoUrl == '') {
								layer.msg('请上传logo图片')
								return false
							}
							data.institutionLogo = logoUrl
							data.institutionNumber = userNumber
							CmsUtility.postAjaxCall(
								//系统设置
								CmsConfig.addressUrl.Mechanism.updateInstitutionRegisterInfo,
								data,
								function(data) {
									if (data.code == 1000) {
										layer.msg('保存成功')
									} else {
										layer.msg(data.msg)
									}
								},
								function(data) {
									console.log('222')
								}
							)
							// layer.alert(JSON.stringify(data.field), {
							//  title: '最终的提交信息'
							// })
							return false;
						});
					});
				</script>
	</body>

</html>
